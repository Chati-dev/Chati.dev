{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "chati.dev Session",
  "description": "Schema for .chati/session.yaml - runtime state tracking",
  "type": "object",
  "required": ["project", "current_agent", "language", "execution_mode"],
  "properties": {
    "project": {
      "type": "object",
      "required": ["name", "type", "state"],
      "properties": {
        "name": { "type": "string", "description": "Project name" },
        "type": { "enum": ["greenfield", "brownfield"], "description": "Project type" },
        "state": { "enum": ["clarity", "build", "validate", "deploy", "completed"], "description": "Current pipeline macro-phase" }
      }
    },
    "execution_mode": {
      "enum": ["interactive", "autonomous"],
      "default": "interactive",
      "description": "interactive = agent-driven guided mode; autonomous = Ralph Wiggum mode (Dev agent)"
    },
    "current_agent": {
      "type": "string",
      "description": "Currently active agent name"
    },
    "language": {
      "enum": ["en", "pt", "es", "fr"],
      "default": "en",
      "description": "User interaction language (artifacts always English)"
    },
    "ides": {
      "type": "array",
      "items": {
        "enum": ["claude-code", "vscode", "antigravity", "cursor", "windsurf", "gemini-cli", "github-copilot"]
      },
      "description": "Configured IDEs"
    },
    "mcps": {
      "type": "array",
      "items": { "type": "string" },
      "description": "Installed MCPs"
    },
    "user_level": {
      "enum": ["auto", "vibecoder", "power_user"],
      "default": "auto",
      "description": "Detected user expertise level"
    },
    "user_level_confidence": {
      "type": "number",
      "minimum": 0,
      "maximum": 1,
      "default": 0,
      "description": "Progressive detection confidence (0.0 - 1.0)"
    },
    "agents": {
      "type": "object",
      "description": "Status tracking for all 12 specialized agents",
      "patternProperties": {
        ".*": {
          "type": "object",
          "required": ["status", "score", "criteria_count"],
          "properties": {
            "status": { "enum": ["pending", "in_progress", "completed"] },
            "score": { "type": "number", "minimum": 0, "maximum": 100 },
            "criteria_count": { "type": "integer", "minimum": 0 },
            "completed_at": { "type": ["string", "null"], "format": "date-time" }
          }
        }
      }
    },
    "backlog": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["id", "title", "priority", "status"],
        "properties": {
          "id": { "type": "string", "pattern": "^BL-\\d{3}$" },
          "title": { "type": "string" },
          "priority": { "enum": ["high", "medium", "low"] },
          "status": { "enum": ["pending", "in_progress", "done", "deferred"] },
          "source_agent": { "type": "string" },
          "target_agent": { "type": "string" },
          "created_at": { "type": ["string", "null"], "format": "date-time" },
          "notes": { "type": "string" }
        }
      }
    },
    "last_handoff": { "type": "string" },
    "deviations": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "timestamp": { "type": "string", "format": "date-time" },
          "from_agent": { "type": "string" },
          "to_agent": { "type": "string" },
          "reason": { "type": "string" },
          "resolved": { "type": "boolean" }
        }
      }
    }
  }
}
