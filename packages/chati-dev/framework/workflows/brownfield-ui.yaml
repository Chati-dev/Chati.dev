# Brownfield UI Workflow
# Frontend/UI changes for existing projects

workflow:
  id: brownfield-ui
  name: Brownfield UI Enhancement
  version: "1.0.0"
  type: brownfield
  project_types: [ui-modernization, frontend-migration, component-library, design-system-update]
  description: >
    Pipeline for frontend/UI changes in existing projects.
    Same as brownfield-fullstack but UX agent takes a larger role,
    including Design System audit and component inventory.
    Architect focuses on frontend architecture and state management.

phases:
  - phase: 0
    name: Deep Discovery
    category: DISCOVER
    sequence:
      - agent: brownfield-wu
        action: full-discovery
        creates: [chati.dev/artifacts/0-WU/wu-full-report.md]
        notes: "UX scout call gets extra attention for component audit"

  - phase: 1
    name: Problem Definition
    category: DISCOVER
    sequence:
      - agent: brief
        action: problem-extraction
        creates: [chati.dev/artifacts/1-Brief/brief-report.md]

  - phase: 2
    name: Architecture & Experience
    category: PLAN
    sequence:
      - agent: architect
        action: assess-architecture
        creates: [chati.dev/artifacts/3-Architecture/architecture.md]
        notes: "Focus on frontend architecture, state management, component patterns"
      - agent: detail
        action: create-prd
        creates: [chati.dev/artifacts/2-PRD/prd.md]
        template: brownfield-prd-tmpl.yaml
      - agent: ux
        action: define-experience
        creates: [chati.dev/artifacts/4-UX/ux-specification.md]
        notes: "Full Design System audit + new token definitions"

  - phase: 3
    name: Execution Planning
    category: PLAN
    sequence:
      - agent: phases
        action: create-roadmap
        creates: [chati.dev/artifacts/5-Phases/phases.md]
      - agent: tasks
        action: create-tasks
        creates: [chati.dev/artifacts/6-Tasks/tasks.md]

  - phase: 4
    name: Planning Quality Gate
    category: PLAN
    sequence:
      - agent: qa-planning
        action: validate-traceability
        creates: [chati.dev/artifacts/7-QA-Planning/qa-planning-report.md]

  - phase: 5
    name: Implementation
    category: BUILD
    sequence:
      - agent: dev
        action: implement-tasks
        notes: "Design System token enforcement is critical for UI work"
      - agent: qa-implementation
        action: validate-code
        creates: [chati.dev/artifacts/8-Validation/qa-implementation-report.md]

  - phase: 6
    name: Deployment
    category: DEPLOY
    sequence:
      - agent: devops
        action: deploy
        creates: [chati.dev/artifacts/8-Validation/deploy-report.md]

transitions:
  discover_to_plan:
    trigger: "brief.status == completed"
    type: automatic
    action: "Update project.state = plan"
  plan_to_build:
    trigger: "qa-planning.score >= 95"
    type: automatic
    action: "Update project.state = build"
  build_to_validate:
    trigger: "dev.status == completed"
    type: automatic
    action: "Update project.state = validate"
  validate_to_preview:
    trigger: "qa-implementation.status == approved"
    type: automatic
    action: "Launch user preview (orchestrator-preview task)"
    notes: "User must approve preview before advancing to deploy"
  preview_to_deploy:
    trigger: "user_preview.decision in [approve_keep, approve_kill]"
    type: manual
    action: "Update project.state = deploy"
    notes: "User explicitly approves the preview"
  deploy_to_completed:
    trigger: "devops.status == completed"
    type: automatic
    action: "Update project.state = completed"
  backward_to_plan:
    trigger: "qa-implementation.issue_type in [spec, architecture]"
    type: backward
    action: "Update project.state = plan, route to responsible agent"
  backward_to_discover:
    trigger: "qa-implementation.issue_type in [requirements, scope]"
    type: backward
    action: "Update project.state = discover, route to brief or wu agent"
