<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chati.dev - AI-Orchestrated Development System</title>
  <style>
    /* ===== RESET & BASE ===== */
    *, *::before, *::after {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg: #0a0a1a;
      --card: #12122a;
      --card-border: rgba(255,255,255,0.08);
      --discover: #3B82F6;
      --plan: #6366F1;
      --planning: #3B82F6;
      --build: #10B981;
      --deploy: #F59E0B;
      --quality: #8B5CF6;
      --constitution: #EF4444;
      --prism: #06B6D4;
      --orchestrator: #F59E0B;
      --text-primary: #e2e8f0;
      --text-secondary: #64748b;
      --haiku: #22d3ee;
      --sonnet: #a78bfa;
      --opus: #f472b6;
      --accent-gradient: linear-gradient(135deg, #3B82F6, #8B5CF6, #06B6D4);
      --nav-bg: rgba(10,10,26,0.85);
      --nav-border: rgba(255,255,255,0.08);
      --dot-grid: rgba(255,255,255,0.03);
      --tooltip-bg: #1e1e3a;
      --tooltip-border: rgba(255,255,255,0.15);
      --hover-bg: rgba(255,255,255,0.05);
      --table-hover: rgba(255,255,255,0.02);
      --table-border: rgba(255,255,255,0.03);
      --meter-bg: rgba(255,255,255,0.03);
      --mode-scope-bg: rgba(255,255,255,0.03);
      --bracket-bg: rgba(255,255,255,0.02);
    }

    [data-theme="light"] {
      --bg: #f8fafc;
      --card: #ffffff;
      --card-border: rgba(0,0,0,0.08);
      --text-primary: #1e293b;
      --text-secondary: #64748b;
      --nav-bg: rgba(248,250,252,0.85);
      --nav-border: rgba(0,0,0,0.08);
      --dot-grid: rgba(0,0,0,0.03);
      --tooltip-bg: #ffffff;
      --tooltip-border: rgba(0,0,0,0.12);
      --hover-bg: rgba(0,0,0,0.04);
      --table-hover: rgba(0,0,0,0.02);
      --table-border: rgba(0,0,0,0.05);
      --meter-bg: rgba(0,0,0,0.04);
      --mode-scope-bg: rgba(0,0,0,0.04);
      --bracket-bg: rgba(0,0,0,0.02);
    }

    html {
      scroll-behavior: smooth;
    }

    body {
      font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg);
      color: var(--text-primary);
      min-height: 100vh;
      overflow-x: hidden;
      line-height: 1.6;
    }

    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background-image: radial-gradient(var(--dot-grid) 1px, transparent 1px);
      background-size: 32px 32px;
      pointer-events: none;
      z-index: 0;
    }

    /* ===== SCROLL REVEAL ===== */
    .reveal {
      opacity: 0;
      transform: translateY(30px);
      transition: opacity 0.8s ease, transform 0.8s ease;
    }
    .reveal.visible {
      opacity: 1;
      transform: translateY(0);
    }
    .reveal-delay-1 { transition-delay: 0.1s; }
    .reveal-delay-2 { transition-delay: 0.2s; }
    .reveal-delay-3 { transition-delay: 0.3s; }
    .reveal-delay-4 { transition-delay: 0.4s; }
    .reveal-delay-5 { transition-delay: 0.5s; }

    /* ===== KEYFRAMES ===== */
    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    @keyframes bounce {
      0%, 100% { transform: translateY(0) translateX(-50%); }
      50% { transform: translateY(10px) translateX(-50%); }
    }

    @keyframes dashFlow {
      to { stroke-dashoffset: -20; }
    }

    @keyframes pulseGlow {
      0%, 100% { box-shadow: 0 0 8px rgba(59,130,246,0.2); }
      50% { box-shadow: 0 0 20px rgba(59,130,246,0.4); }
    }

    @keyframes meterPulse {
      0%, 100% { opacity: 0.7; }
      50% { opacity: 1; }
    }

    @keyframes slideInLeft {
      from { opacity: 0; transform: translateX(-40px); }
      to { opacity: 1; transform: translateX(0); }
    }

    @keyframes fadeInScale {
      from { opacity: 0; transform: scale(0.9); }
      to { opacity: 1; transform: scale(1); }
    }

    @keyframes heroGradient {
      0% { background-position: 0% 0%; }
      25% { background-position: 100% 0%; }
      50% { background-position: 100% 100%; }
      75% { background-position: 0% 100%; }
      100% { background-position: 0% 0%; }
    }

    @keyframes orchGlow {
      0%, 100% { filter: drop-shadow(0 0 6px rgba(245,158,11,0.2)); }
      50% { filter: drop-shadow(0 0 14px rgba(245,158,11,0.4)); }
    }

    /* ===== STICKY NAV ===== */
    .sticky-nav {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1000;
      background: var(--nav-bg);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--nav-border);
      padding: 0 24px;
      height: 48px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 4px;
      transform: translateY(-100%);
      transition: transform 0.3s ease;
    }
    .sticky-nav.visible {
      transform: translateY(0);
    }
    .nav-left {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-shrink: 0;
    }
    .nav-logo {
      font-size: 14px;
      font-weight: 800;
      background: var(--accent-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      white-space: nowrap;
    }
    .nav-center {
      display: flex;
      align-items: center;
      gap: 4px;
      flex-wrap: nowrap;
      overflow-x: auto;
    }
    .nav-right {
      display: flex;
      align-items: center;
      gap: 6px;
      flex-shrink: 0;
    }
    .nav-pill {
      padding: 6px 14px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 500;
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.3s ease;
      border: none;
      background: transparent;
      white-space: nowrap;
    }
    .nav-pill:hover {
      color: var(--text-primary);
      background: var(--hover-bg);
    }
    .nav-pill.active {
      color: #fff;
      background: rgba(59,130,246,0.2);
    }
    .nav-toggle {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 32px;
      height: 32px;
      border-radius: 8px;
      border: 1px solid var(--card-border);
      background: transparent;
      color: var(--text-secondary);
      cursor: pointer;
      font-size: 16px;
      transition: all 0.2s ease;
    }
    .nav-toggle:hover {
      color: var(--text-primary);
      background: var(--hover-bg);
    }
    .lang-toggle {
      font-size: 11px;
      font-weight: 700;
      width: auto;
      padding: 0 8px;
      letter-spacing: 0.5px;
    }
    .lang-toggle .active-lang {
      color: var(--planning);
    }

    /* ===== SECTION BASE ===== */
    .section {
      position: relative;
      z-index: 1;
      padding: 100px 48px;
      max-width: 1600px;
      margin: 0 auto;
    }
    .section#pipeline {
      max-width: none;
      padding: 100px 48px;
    }
    .section-label {
      font-size: 13px;
      font-weight: 700;
      letter-spacing: 3px;
      text-transform: uppercase;
      color: var(--text-secondary);
      margin-bottom: 12px;
    }
    .section-title {
      font-size: 44px;
      font-weight: 800;
      margin-bottom: 16px;
      background: var(--accent-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .section-subtitle {
      font-size: 20px;
      color: var(--text-secondary);
      max-width: 900px;
      margin-bottom: 56px;
      line-height: 1.7;
    }

    /* ===== 1. HERO ===== */
    .hero {
      position: relative;
      z-index: 1;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 40px 24px;
      overflow: hidden;
    }
    .hero-bg {
      position: absolute;
      inset: 0;
      background: radial-gradient(ellipse at 30% 20%, rgba(59,130,246,0.08) 0%, transparent 50%),
                  radial-gradient(ellipse at 70% 80%, rgba(139,92,246,0.06) 0%, transparent 50%),
                  radial-gradient(ellipse at 50% 50%, rgba(6,182,212,0.04) 0%, transparent 70%);
      background-size: 200% 200%;
      animation: heroGradient 20s ease infinite;
      z-index: 0;
    }
    .hero-content {
      position: relative;
      z-index: 1;
    }
    .hero-badge {
      display: inline-block;
      padding: 5px 16px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      color: var(--prism);
      background: rgba(6,182,212,0.1);
      border: 1px solid rgba(6,182,212,0.2);
      margin-bottom: 32px;
      letter-spacing: 1px;
    }
    .hero-title {
      font-size: clamp(48px, 8vw, 80px);
      font-weight: 900;
      background: var(--accent-gradient);
      background-size: 200% 200%;
      animation: gradientShift 6s ease infinite;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 16px;
      line-height: 1.1;
    }
    .hero-subtitle {
      font-size: clamp(18px, 2.5vw, 24px);
      color: var(--text-secondary);
      font-weight: 400;
      margin-bottom: 56px;
      letter-spacing: 0.5px;
    }
    .hero-stats {
      display: flex;
      gap: 40px;
      flex-wrap: wrap;
      justify-content: center;
    }
    .hero-stat {
      text-align: center;
    }
    .hero-stat-number {
      font-size: 48px;
      font-weight: 800;
      background: var(--accent-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      line-height: 1.2;
    }
    .hero-stat-label {
      font-size: 15px;
      color: var(--text-secondary);
      font-weight: 500;
      margin-top: 4px;
    }
    .scroll-indicator {
      position: absolute;
      bottom: 32px;
      left: 50%;
      transform: translateX(-50%);
      animation: bounce 2s infinite;
      color: var(--text-secondary);
      font-size: 24px;
      cursor: pointer;
      z-index: 1;
    }

    /* ===== 2. HOW IT WORKS ===== */
    .how-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 24px;
    }
    .how-card {
      background: var(--card);
      border: 1px solid var(--card-border);
      border-radius: 16px;
      padding: 40px 32px;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    .how-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
    }
    .how-card[data-phase="discover"]::before { background: var(--discover); }
    .how-card[data-phase="plan"]::before { background: var(--plan); }
    .how-card[data-phase="build"]::before { background: var(--build); }
    .how-card[data-phase="deploy"]::before { background: var(--deploy); }
    .how-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
    }
    .how-icon {
      font-size: 32px;
      margin-bottom: 16px;
      display: block;
    }
    .how-card[data-phase="discover"] .how-icon { color: var(--discover); }
    .how-card[data-phase="plan"] .how-icon { color: var(--plan); }
    .how-card[data-phase="build"] .how-icon { color: var(--build); }
    .how-card[data-phase="deploy"] .how-icon { color: var(--deploy); }
    .how-phase-name {
      font-size: 26px;
      font-weight: 700;
      margin-bottom: 12px;
    }
    .how-card[data-phase="discover"] .how-phase-name { color: var(--discover); }
    .how-card[data-phase="plan"] .how-phase-name { color: var(--plan); }
    .how-card[data-phase="build"] .how-phase-name { color: var(--build); }
    .how-card[data-phase="deploy"] .how-phase-name { color: var(--deploy); }
    .how-description {
      font-size: 16px;
      color: var(--text-secondary);
      line-height: 1.7;
      margin-bottom: 20px;
    }
    .how-agent-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 600;
    }
    .how-card[data-phase="discover"] .how-agent-badge { background: rgba(59,130,246,0.1); color: var(--discover); }
    .how-card[data-phase="plan"] .how-agent-badge { background: rgba(99,102,241,0.1); color: var(--plan); }
    .how-card[data-phase="build"] .how-agent-badge { background: rgba(16,185,129,0.1); color: var(--build); }
    .how-card[data-phase="deploy"] .how-agent-badge { background: rgba(245,158,11,0.1); color: var(--deploy); }

    /* ===== 3. THE PIPELINE ===== */
    .pipeline-wrapper {
      width: 100%;
      overflow-x: auto;
      padding: 20px 0 40px;
      -webkit-overflow-scrolling: touch;
    }
    .pipeline-container {
      min-width: 1300px;
      padding: 0 20px;
    }
    .pipeline-svg {
      width: 100%;
      height: auto;
    }
    .pipeline-svg text {
      font-family: 'Inter', system-ui, sans-serif;
    }
    .pipeline-node {
      cursor: pointer;
      transition: filter 0.2s ease;
    }
    .pipeline-node:hover {
      filter: brightness(1.2);
    }
    .pipeline-node:hover rect {
      stroke-width: 2;
    }
    .pipeline-tooltip {
      position: absolute;
      background: var(--tooltip-bg);
      border: 1px solid var(--tooltip-border);
      border-radius: 10px;
      padding: 12px 16px;
      font-size: 13px;
      color: var(--text-primary);
      max-width: 260px;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.2s ease;
      z-index: 100;
      box-shadow: 0 8px 32px rgba(0,0,0,0.4);
    }
    .pipeline-tooltip.show {
      opacity: 1;
    }
    .pipeline-label-badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 6px;
      font-size: 9px;
      font-weight: 700;
      letter-spacing: 1px;
    }
    .dash-line {
      stroke-dasharray: 8 4;
      animation: dashFlow 1s linear infinite;
    }

    /* ===== 4. AGENTS GRID ===== */
    .agents-phase-group {
      margin-bottom: 48px;
    }
    .agents-phase-header {
      font-size: 16px;
      font-weight: 700;
      letter-spacing: 2px;
      text-transform: uppercase;
      margin-bottom: 20px;
      padding-left: 16px;
      position: relative;
    }
    .agents-phase-header::before {
      content: '';
      position: absolute;
      left: 0;
      top: 2px;
      bottom: 2px;
      width: 3px;
      border-radius: 2px;
    }
    .agents-phase-header[data-phase="orchestrator"]::before { background: var(--orchestrator); }
    .agents-phase-header[data-phase="orchestrator"] { color: var(--orchestrator); }
    .agents-phase-header[data-phase="discover"]::before { background: var(--discover); }
    .agents-phase-header[data-phase="discover"] { color: var(--discover); }
    .agents-phase-header[data-phase="plan"]::before { background: var(--plan); }
    .agents-phase-header[data-phase="plan"] { color: var(--plan); }
    .agents-phase-header[data-phase="quality"]::before { background: var(--quality); }
    .agents-phase-header[data-phase="quality"] { color: var(--quality); }
    .agents-phase-header[data-phase="build"]::before { background: var(--build); }
    .agents-phase-header[data-phase="build"] { color: var(--build); }
    .agents-phase-header[data-phase="deploy"]::before { background: var(--deploy); }
    .agents-phase-header[data-phase="deploy"] { color: var(--deploy); }

    .agents-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 16px;
    }
    .agent-card {
      background: var(--card);
      border: 1px solid var(--card-border);
      border-radius: 14px;
      padding: 24px;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    .agent-card::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 3px;
    }
    .agent-card[data-phase="orchestrator"]::before { background: var(--orchestrator); }
    .agent-card[data-phase="discover"]::before { background: var(--discover); }
    .agent-card[data-phase="plan"]::before { background: var(--plan); }
    .agent-card[data-phase="quality"]::before { background: var(--quality); }
    .agent-card[data-phase="build"]::before { background: var(--build); }
    .agent-card[data-phase="deploy"]::before { background: var(--deploy); }
    .agent-card:hover {
      transform: translateY(-4px);
      border-color: var(--tooltip-border);
    }
    .agent-card[data-phase="discover"]:hover { box-shadow: 0 8px 32px rgba(59,130,246,0.12); }
    .agent-card[data-phase="plan"]:hover { box-shadow: 0 8px 32px rgba(99,102,241,0.12); }
    .agent-card[data-phase="quality"]:hover { box-shadow: 0 8px 32px rgba(139,92,246,0.12); }
    .agent-card[data-phase="build"]:hover { box-shadow: 0 8px 32px rgba(16,185,129,0.12); }
    .agent-card[data-phase="deploy"]:hover { box-shadow: 0 8px 32px rgba(245,158,11,0.12); }
    .agent-card[data-phase="orchestrator"]:hover { box-shadow: 0 8px 32px rgba(245,158,11,0.12); }

    .agent-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
    }
    .agent-name {
      font-size: 18px;
      font-weight: 700;
    }
    .agent-model-badge {
      padding: 2px 10px;
      border-radius: 10px;
      font-size: 12px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .agent-model-badge.haiku { background: rgba(34,211,238,0.12); color: var(--haiku); }
    .agent-model-badge.sonnet { background: rgba(167,139,250,0.12); color: var(--sonnet); }
    .agent-model-badge.opus { background: rgba(244,114,182,0.12); color: var(--opus); }

    .agent-mission {
      font-size: 15px;
      color: var(--text-secondary);
      line-height: 1.6;
      margin-bottom: 12px;
    }
    .agent-phase-badge {
      display: inline-block;
      padding: 2px 10px;
      border-radius: 8px;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    .agent-phase-badge[data-phase="orchestrator"] { background: rgba(245,158,11,0.1); color: var(--orchestrator); }
    .agent-phase-badge[data-phase="discover"] { background: rgba(59,130,246,0.1); color: var(--discover); }
    .agent-phase-badge[data-phase="plan"] { background: rgba(99,102,241,0.1); color: var(--plan); }
    .agent-phase-badge[data-phase="quality"] { background: rgba(139,92,246,0.1); color: var(--quality); }
    .agent-phase-badge[data-phase="build"] { background: rgba(16,185,129,0.1); color: var(--build); }
    .agent-phase-badge[data-phase="deploy"] { background: rgba(245,158,11,0.1); color: var(--deploy); }

    /* Agent Modal */
    .agent-modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.6);
      backdrop-filter: blur(4px);
      z-index: 2000;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
    }
    .agent-modal-overlay.active {
      opacity: 1;
      pointer-events: all;
    }
    .agent-modal {
      background: var(--card);
      border: 1px solid var(--card-border);
      border-radius: 20px;
      padding: 40px;
      max-width: 700px;
      width: 90%;
      max-height: 85vh;
      overflow-y: auto;
      position: relative;
      transform: scale(0.9) translateY(20px);
      transition: transform 0.3s ease;
    }
    .agent-modal-overlay.active .agent-modal {
      transform: scale(1) translateY(0);
    }
    .agent-modal-close {
      position: absolute;
      top: 16px;
      right: 16px;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      border: 1px solid var(--card-border);
      background: transparent;
      color: var(--text-secondary);
      font-size: 18px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }
    .agent-modal-close:hover {
      background: var(--hover-bg);
      color: var(--text-primary);
    }
    .agent-modal-header {
      display: flex;
      align-items: center;
      gap: 16px;
      margin-bottom: 20px;
      padding-right: 40px;
    }
    .agent-modal-name {
      font-size: 28px;
      font-weight: 800;
    }
    .agent-modal .agent-model-badge {
      font-size: 13px;
      padding: 4px 14px;
    }
    .agent-modal-mission {
      font-size: 17px;
      color: var(--text-secondary);
      line-height: 1.7;
      margin-bottom: 24px;
    }
    .agent-modal-phase {
      display: inline-block;
      padding: 4px 14px;
      border-radius: 10px;
      font-size: 13px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      margin-bottom: 28px;
    }
    .agent-modal-sections {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    .agent-modal-section {
      border-radius: 12px;
      padding: 16px 20px;
    }
    .agent-modal-section.exclusive-section { background: rgba(6,182,212,0.06); border: 1px solid rgba(6,182,212,0.12); }
    .agent-modal-section.allowed-section { background: rgba(16,185,129,0.06); border: 1px solid rgba(16,185,129,0.12); }
    .agent-modal-section.blocked-section { background: rgba(239,68,68,0.06); border: 1px solid rgba(239,68,68,0.12); }
    .agent-modal-section.outputs-section { background: rgba(245,158,11,0.06); border: 1px solid rgba(245,158,11,0.12); }
    .agent-modal-section.rules-section { background: rgba(139,92,246,0.06); border: 1px solid rgba(139,92,246,0.12); }
    .agent-modal-section-label {
      font-size: 12px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      margin-bottom: 10px;
    }
    .agent-modal-section.exclusive-section .agent-modal-section-label { color: var(--prism); }
    .agent-modal-section.allowed-section .agent-modal-section-label { color: var(--build); }
    .agent-modal-section.blocked-section .agent-modal-section-label { color: var(--constitution); }
    .agent-modal-section.outputs-section .agent-modal-section-label { color: var(--deploy); }
    .agent-modal-section.rules-section .agent-modal-section-label { color: var(--quality); }
    .agent-modal-list {
      list-style: none;
      padding: 0;
      margin: 0;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 4px 16px;
    }
    .agent-modal-list.rules-list {
      grid-template-columns: 1fr;
    }
    .agent-modal-list li {
      font-size: 14px;
      color: var(--text-primary);
      padding: 4px 0 4px 18px;
      position: relative;
      line-height: 1.5;
    }
    .agent-modal-list li::before {
      content: '';
      position: absolute;
      left: 0;
      top: 12px;
      width: 6px;
      height: 6px;
      border-radius: 50%;
    }
    .agent-modal-list.exclusive li::before { background: var(--prism); }
    .agent-modal-list.allowed li::before { background: var(--build); }
    .agent-modal-list.blocked li::before { background: var(--constitution); }
    .agent-modal-list.outputs li::before { background: var(--deploy); }
    .agent-modal-list.rules li::before { background: var(--quality); }
    .agent-modal-upgrade {
      margin-top: 16px;
      padding: 16px 20px;
      border-radius: 12px;
      background: rgba(139,92,246,0.06);
      border: 1px solid rgba(139,92,246,0.12);
      font-size: 14px;
      color: var(--text-secondary);
    }
    .agent-modal-upgrade strong {
      color: var(--quality);
    }

    /* ===== 5. PRISM ===== */
    .prism-layout {
      display: grid;
      grid-template-columns: 1fr 300px;
      gap: 48px;
      align-items: start;
    }
    .prism-pyramid {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
    }
    .prism-layer {
      border-radius: 12px;
      padding: 20px 24px;
      text-align: center;
      transition: all 0.3s ease;
      cursor: default;
      position: relative;
      border: 1px solid transparent;
    }
    .prism-layer:hover {
      transform: scale(1.02);
    }
    .prism-layer-l0 {
      width: 100%;
      background: rgba(239,68,68,0.08);
      border-color: rgba(239,68,68,0.2);
    }
    .prism-layer-l1 {
      width: 88%;
      background: rgba(6,182,212,0.08);
      border-color: rgba(6,182,212,0.2);
    }
    .prism-layer-l2 {
      width: 74%;
      background: rgba(59,130,246,0.08);
      border-color: rgba(59,130,246,0.2);
    }
    .prism-layer-l3 {
      width: 58%;
      background: rgba(139,92,246,0.08);
      border-color: rgba(139,92,246,0.2);
    }
    .prism-layer-l4 {
      width: 42%;
      background: rgba(245,158,11,0.08);
      border-color: rgba(245,158,11,0.2);
    }
    .prism-layer-tag {
      font-size: 12px;
      font-weight: 700;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      margin-bottom: 4px;
    }
    .prism-layer-l0 .prism-layer-tag { color: var(--constitution); }
    .prism-layer-l1 .prism-layer-tag { color: var(--prism); }
    .prism-layer-l2 .prism-layer-tag { color: var(--planning); }
    .prism-layer-l3 .prism-layer-tag { color: var(--quality); }
    .prism-layer-l4 .prism-layer-tag { color: var(--deploy); }
    .prism-layer-name {
      font-size: 18px;
      font-weight: 600;
    }
    .prism-layer-desc {
      font-size: 14px;
      color: var(--text-secondary);
      margin-top: 2px;
    }
    .prism-always-badge {
      display: inline-block;
      padding: 1px 8px;
      border-radius: 6px;
      font-size: 9px;
      font-weight: 700;
      background: rgba(16,185,129,0.15);
      color: var(--build);
      margin-left: 6px;
    }
    .prism-conditional-badge {
      display: inline-block;
      padding: 1px 8px;
      border-radius: 6px;
      font-size: 9px;
      font-weight: 700;
      background: rgba(245,158,11,0.15);
      color: var(--deploy);
      margin-left: 6px;
    }

    /* Context meter */
    .context-meter {
      background: var(--card);
      border: 1px solid var(--card-border);
      border-radius: 16px;
      padding: 24px;
    }
    .context-meter-title {
      font-size: 15px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      color: var(--text-secondary);
      margin-bottom: 20px;
      text-align: center;
    }
    .meter-bar-container {
      position: relative;
      height: 280px;
      width: 40px;
      margin: 0 auto 20px;
      background: var(--meter-bg);
      border-radius: 20px;
      overflow: hidden;
      border: 1px solid var(--card-border);
    }
    .meter-zone {
      position: absolute;
      left: 0;
      right: 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .meter-zone-fresh { top: 0; height: 25%; background: rgba(16,185,129,0.15); }
    .meter-zone-moderate { top: 25%; height: 25%; background: rgba(59,130,246,0.12); }
    .meter-zone-depleted { top: 50%; height: 25%; background: rgba(245,158,11,0.12); }
    .meter-zone-critical { top: 75%; height: 25%; background: rgba(239,68,68,0.12); }

    .meter-indicator {
      position: absolute;
      left: -6px;
      right: -6px;
      height: 4px;
      background: #fff;
      border-radius: 4px;
      box-shadow: 0 0 10px rgba(255,255,255,0.5);
      transition: top 1.5s ease;
      animation: meterPulse 2s infinite;
    }

    .bracket-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .bracket-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
      padding: 6px 10px;
      border-radius: 8px;
      background: var(--bracket-bg);
    }
    .bracket-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      flex-shrink: 0;
    }
    .bracket-dot.fresh { background: var(--build); }
    .bracket-dot.moderate { background: var(--planning); }
    .bracket-dot.depleted { background: var(--deploy); }
    .bracket-dot.critical { background: var(--constitution); }
    .bracket-name {
      font-weight: 600;
      min-width: 72px;
    }
    .bracket-desc {
      color: var(--text-secondary);
    }

    /* Mode governance */
    .mode-cards {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 16px;
      margin-top: 56px;
    }
    .mode-card {
      background: var(--card);
      border: 1px solid var(--card-border);
      border-radius: 14px;
      padding: 24px;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .mode-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 24px rgba(0,0,0,0.2);
    }
    .mode-card-title {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 12px;
    }
    .mode-scope-label {
      font-size: 12px;
      font-weight: 700;
      letter-spacing: 1px;
      text-transform: uppercase;
      color: var(--text-secondary);
      margin-bottom: 4px;
      margin-top: 12px;
    }
    .mode-scope-value {
      font-size: 15px;
      color: var(--text-primary);
      font-family: 'Courier New', monospace;
      padding: 4px 8px;
      background: var(--mode-scope-bg);
      border-radius: 6px;
      display: inline-block;
    }

    /* ===== 6. HOOKS ===== */
    .hooks-timeline {
      position: relative;
      display: flex;
      flex-direction: column;
      gap: 24px;
    }
    .hooks-timeline::before {
      content: '';
      position: absolute;
      left: 24px;
      top: 0;
      bottom: 0;
      width: 2px;
      background: linear-gradient(180deg, var(--prism), var(--quality), var(--deploy), var(--constitution), var(--build));
      border-radius: 2px;
    }
    .hook-card {
      background: var(--card);
      border: 1px solid var(--card-border);
      border-radius: 14px;
      padding: 24px 24px 24px 64px;
      position: relative;
      transition: all 0.3s ease;
    }
    .hook-card:hover {
      transform: translateX(4px);
      border-color: var(--tooltip-border);
    }
    .hook-dot {
      position: absolute;
      left: 17px;
      top: 28px;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      border: 3px solid;
    }
    .hook-card[data-hook="prism"] .hook-dot { border-color: var(--prism); background: rgba(6,182,212,0.3); }
    .hook-card[data-hook="model"] .hook-dot { border-color: var(--quality); background: rgba(139,92,246,0.3); }
    .hook-card[data-hook="mode"] .hook-dot { border-color: var(--deploy); background: rgba(245,158,11,0.3); }
    .hook-card[data-hook="constitution"] .hook-dot { border-color: var(--constitution); background: rgba(239,68,68,0.3); }
    .hook-card[data-hook="session"] .hook-dot { border-color: var(--build); background: rgba(16,185,129,0.3); }

    .hook-trigger {
      font-size: 12px;
      font-weight: 700;
      letter-spacing: 1px;
      text-transform: uppercase;
      color: var(--text-secondary);
      margin-bottom: 4px;
    }
    .hook-name {
      font-size: 22px;
      font-weight: 700;
      margin-bottom: 6px;
    }
    .hook-description {
      font-size: 15px;
      color: var(--text-secondary);
      line-height: 1.6;
      margin-bottom: 10px;
    }
    .hook-enforcement {
      display: inline-block;
      padding: 3px 10px;
      border-radius: 8px;
      font-size: 12px;
      font-weight: 700;
      letter-spacing: 0.5px;
    }
    .hook-enforcement.block {
      background: rgba(239,68,68,0.12);
      color: var(--constitution);
    }
    .hook-enforcement.advisory {
      background: rgba(245,158,11,0.12);
      color: var(--deploy);
    }

    /* ===== 7. CONSTITUTION ===== */
    .constitution-principles {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 16px;
      margin-bottom: 48px;
    }
    .principle-card {
      background: var(--card);
      border: 1px solid var(--card-border);
      border-radius: 14px;
      padding: 24px;
      text-align: center;
      transition: all 0.3s ease;
    }
    .principle-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 24px rgba(239,68,68,0.1);
    }
    .principle-number {
      font-size: 40px;
      font-weight: 800;
      color: var(--constitution);
      margin-bottom: 8px;
    }
    .principle-title {
      font-size: 16px;
      font-weight: 700;
      margin-bottom: 6px;
    }
    .principle-desc {
      font-size: 14px;
      color: var(--text-secondary);
      line-height: 1.5;
    }
    .articles-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      margin-bottom: 48px;
    }
    .article-card {
      background: var(--card);
      border: 1px solid var(--card-border);
      border-radius: 10px;
      padding: 16px;
      transition: all 0.3s ease;
    }
    .article-card:hover {
      border-color: var(--tooltip-border);
      transform: translateY(-2px);
    }
    .article-number {
      font-size: 13px;
      font-weight: 700;
      color: var(--constitution);
      margin-bottom: 4px;
    }
    .article-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 4px;
    }
    .article-desc {
      font-size: 14px;
      color: var(--text-secondary);
      line-height: 1.5;
      margin-bottom: 8px;
    }
    .enforcement-badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 6px;
      font-size: 9px;
      font-weight: 700;
      letter-spacing: 0.5px;
    }
    .enforcement-badge.block { background: rgba(239,68,68,0.12); color: var(--constitution); }
    .enforcement-badge.strict { background: rgba(239,68,68,0.12); color: var(--constitution); }
    .enforcement-badge.warn { background: rgba(245,158,11,0.12); color: var(--deploy); }
    .enforcement-badge.guide { background: rgba(59,130,246,0.12); color: var(--planning); }

    .protocols-section-title {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 16px;
    }
    .protocols-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
    }
    .protocol-card {
      background: var(--card);
      border: 1px solid var(--card-border);
      border-radius: 10px;
      padding: 16px;
      transition: all 0.3s ease;
    }
    .protocol-card:hover {
      border-color: rgba(139,92,246,0.3);
      transform: translateY(-2px);
    }
    .protocol-id {
      font-size: 13px;
      font-weight: 700;
      color: var(--quality);
      margin-bottom: 4px;
    }
    .protocol-name {
      font-size: 15px;
      font-weight: 600;
      margin-bottom: 2px;
    }
    .protocol-desc {
      font-size: 13px;
      color: var(--text-secondary);
    }

    /* ===== 8. MEMORY & QUALITY ===== */
    .memory-quality-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 48px;
    }
    .mq-section-title {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 20px;
    }
    .cognitive-sectors {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-bottom: 28px;
    }
    .sector-card {
      background: var(--card);
      border: 1px solid var(--card-border);
      border-radius: 12px;
      padding: 16px;
      transition: all 0.3s ease;
    }
    .sector-card:hover {
      transform: translateY(-2px);
    }
    .sector-icon { font-size: 20px; margin-bottom: 6px; }
    .sector-name { font-size: 16px; font-weight: 600; margin-bottom: 4px; }
    .sector-desc { font-size: 13px; color: var(--text-secondary); line-height: 1.5; }

    .tier-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 20px;
    }
    .tier-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 14px;
      background: var(--card);
      border: 1px solid var(--card-border);
      border-radius: 10px;
      font-size: 13px;
    }
    .tier-label {
      font-weight: 700;
      min-width: 56px;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .tier-label.hot { color: var(--constitution); }
    .tier-label.warm { color: var(--deploy); }
    .tier-label.cold { color: var(--planning); }
    .tier-label.archive { color: var(--text-secondary); }
    .tier-desc { color: var(--text-secondary); font-size: 14px; }

    .quality-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 28px;
    }
    .quality-table th {
      text-align: left;
      font-size: 12px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--text-secondary);
      padding: 10px 12px;
      border-bottom: 1px solid var(--card-border);
    }
    .quality-table td {
      font-size: 15px;
      padding: 10px 12px;
      border-bottom: 1px solid var(--table-border);
    }
    .quality-table tr:hover td {
      background: var(--table-hover);
    }
    .handoff-viz {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .handoff-layer {
      background: var(--card);
      border: 1px solid var(--card-border);
      border-radius: 12px;
      padding: 16px;
    }
    .handoff-layer-title {
      font-size: 15px;
      font-weight: 700;
      margin-bottom: 6px;
    }
    .handoff-layer-desc {
      font-size: 14px;
      color: var(--text-secondary);
      line-height: 1.5;
    }

    /* ===== 9. FOOTER ===== */
    .footer {
      position: relative;
      z-index: 1;
      text-align: center;
      padding: 60px 24px 40px;
      border-top: 1px solid var(--card-border);
    }
    .footer-brand {
      font-size: 16px;
      font-weight: 700;
      margin-bottom: 8px;
      background: var(--accent-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .footer-version {
      font-size: 12px;
      color: var(--text-secondary);
      margin-bottom: 16px;
    }
    .footer-links {
      display: flex;
      gap: 24px;
      justify-content: center;
    }
    .footer-link {
      font-size: 13px;
      color: var(--text-secondary);
      text-decoration: none;
      transition: color 0.2s ease;
    }
    .footer-link:hover {
      color: var(--text-primary);
    }

    /* ===== RESPONSIVE ===== */
    @media (max-width: 1024px) {
      .how-grid { grid-template-columns: repeat(2, 1fr) !important; }
      .agents-grid { grid-template-columns: repeat(2, 1fr); }
      .prism-layout { grid-template-columns: 1fr; }
      .context-meter { margin-top: 32px; }
      .constitution-principles { grid-template-columns: repeat(2, 1fr); }
      .articles-grid { grid-template-columns: repeat(2, 1fr); }
      .protocols-grid { grid-template-columns: repeat(2, 1fr); }
      .memory-quality-grid { grid-template-columns: 1fr; }
      .mode-cards { grid-template-columns: 1fr; }
    }
    @media (max-width: 768px) {
      .section { padding: 60px 16px; }
      .section#pipeline { padding: 60px 16px; }
      .how-grid { grid-template-columns: 1fr !important; }
      .hero-stats { gap: 24px; }
      .hero-stat-number { font-size: 28px; }
      .agents-grid { grid-template-columns: 1fr; }
      .constitution-principles { grid-template-columns: 1fr; }
      .articles-grid { grid-template-columns: 1fr; }
      .protocols-grid { grid-template-columns: 1fr; }
      .cognitive-sectors { grid-template-columns: 1fr; }
      .nav-pill { padding: 4px 10px; font-size: 11px; }
      .sticky-nav { gap: 2px; }
      .nav-left { display: none; }
      .nav-center { gap: 2px; }
    }
  </style>
</head>
<body>

  <!-- Sticky Navigation -->
  <nav class="sticky-nav" id="stickyNav">
    <div class="nav-left">
      <span class="nav-logo">Chati.dev</span>
    </div>
    <div class="nav-center">
      <button class="nav-pill" data-section="hero" onclick="scrollToSection('hero')" data-i18n="nav_home">Home</button>
      <button class="nav-pill" data-section="how-it-works" onclick="scrollToSection('how-it-works')" data-i18n="nav_how">How It Works</button>
      <button class="nav-pill" data-section="pipeline" onclick="scrollToSection('pipeline')" data-i18n="nav_pipeline">Pipeline</button>
      <button class="nav-pill" data-section="agents" onclick="scrollToSection('agents')" data-i18n="nav_agents">Agents</button>
      <button class="nav-pill" data-section="prism" onclick="scrollToSection('prism')">PRISM</button>
      <button class="nav-pill" data-section="hooks" onclick="scrollToSection('hooks')">Hooks</button>
      <button class="nav-pill" data-section="constitution" onclick="scrollToSection('constitution')" data-i18n="nav_constitution">Constitution</button>
      <button class="nav-pill" data-section="memory-quality" onclick="scrollToSection('memory-quality')" data-i18n="nav_memory">Memory</button>
    </div>
    <div class="nav-right">
      <button class="nav-toggle lang-toggle" id="langToggle" onclick="toggleLanguage()" title="Toggle language"><span class="active-lang">EN</span> | PT</button>
      <button class="nav-toggle" id="themeToggle" onclick="toggleTheme()" title="Toggle theme">&#9790;</button>
    </div>
  </nav>

  <!-- ===== 1. HERO ===== -->
  <section class="hero" id="hero">
    <div class="hero-bg"></div>
    <div class="hero-content">
      <span class="hero-badge">v2.0 Orion</span>
      <h1 class="hero-title">Chati.dev</h1>
      <p class="hero-subtitle" data-i18n="hero_subtitle">AI-Orchestrated Development System</p>
      <div class="hero-stats">
        <div class="hero-stat">
          <div class="hero-stat-number" data-target="13">0</div>
          <div class="hero-stat-label" data-i18n="stat_agents">Agents</div>
        </div>
        <div class="hero-stat">
          <div class="hero-stat-number" data-target="5">0</div>
          <div class="hero-stat-label" data-i18n="stat_prism">PRISM Layers</div>
        </div>
        <div class="hero-stat">
          <div class="hero-stat-number" data-target="17">0</div>
          <div class="hero-stat-label" data-i18n="stat_articles">Constitution Articles</div>
        </div>
        <div class="hero-stat">
          <div class="hero-stat-number" data-target="5">0</div>
          <div class="hero-stat-label" data-i18n="stat_workflows">Workflows</div>
        </div>
      </div>
    </div>
    <div class="scroll-indicator" onclick="scrollToSection('how-it-works')">&#8964;</div>
  </section>

  <!-- ===== 2. HOW IT WORKS ===== -->
  <section class="section" id="how-it-works">
    <div class="section-label reveal" data-i18n="how_label">The Process</div>
    <h2 class="section-title reveal" data-i18n="how_title">How It Works</h2>
    <p class="section-subtitle reveal" data-i18n="how_subtitle">Four phases. Thirteen agents. One unified pipeline that transforms ideas into production-ready software.</p>
    <div class="how-grid" style="grid-template-columns: repeat(4, 1fr);">
      <div class="how-card reveal reveal-delay-1" data-phase="discover">
        <span class="how-icon">&#9672;</span>
        <h3 class="how-phase-name">DISCOVER</h3>
        <p class="how-description" data-i18n="how_discover_desc">We discover before we plan. Three agents analyze the operational landscape, detect tech stacks, and extract requirements before any design begins.</p>
        <span class="how-agent-badge" data-i18n="how_discover_badge">3 Agents</span>
      </div>
      <div class="how-card reveal reveal-delay-2" data-phase="plan">
        <span class="how-icon">&#9670;</span>
        <h3 class="how-phase-name">PLAN</h3>
        <p class="how-description" data-i18n="how_plan_desc">Five agents transform requirements into architecture, UX, phases, and atomic tasks. Every artifact is validated and feeds the next.</p>
        <span class="how-agent-badge" data-i18n="how_plan_badge">5 Agents</span>
      </div>
      <div class="how-card reveal reveal-delay-3" data-phase="build">
        <span class="how-icon">&#9881;</span>
        <h3 class="how-phase-name">BUILD</h3>
        <p class="how-description" data-i18n="how_build_desc">One agent implements with surgical precision. Self-critique protocol catches bugs before tests run. Quality gate validates everything against acceptance criteria.</p>
        <span class="how-agent-badge" data-i18n="how_build_badge">1 Agent</span>
      </div>
      <div class="how-card reveal reveal-delay-4" data-phase="deploy">
        <span class="how-icon">&#9650;</span>
        <h3 class="how-phase-name">DEPLOY</h3>
        <p class="how-description" data-i18n="how_deploy_desc">Automated deployment with rollback procedures. Documentation generated. CI/CD configured. Monitoring in place before anything reaches production.</p>
        <span class="how-agent-badge" data-i18n="how_deploy_badge">1 Agent</span>
      </div>
    </div>
  </section>

  <!-- ===== 3. THE PIPELINE ===== -->
  <section class="section" id="pipeline">
    <div class="section-label reveal" data-i18n="pipeline_label">Architecture</div>
    <h2 class="section-title reveal" data-i18n="pipeline_title">The Pipeline</h2>
    <p class="section-subtitle reveal" data-i18n="pipeline_subtitle">Every request flows through a validated pipeline. Quality gates enforce thresholds. No shortcuts allowed.</p>
    <div class="pipeline-wrapper reveal reveal-delay-2">
      <div class="pipeline-container">
        <svg class="pipeline-svg" viewBox="0 0 1400 280" xmlns="http://www.w3.org/2000/svg">
          <!-- ===== ORCHESTRATOR BAR AT TOP ===== -->
          <defs>
            <filter id="orchGlow">
              <feGaussianBlur stdDeviation="3" result="blur"/>
              <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
            </filter>
          </defs>
          <rect x="20" y="8" width="1360" height="44" rx="10" fill="rgba(245,158,11,0.07)" stroke="rgba(245,158,11,0.3)" stroke-width="1.5" filter="url(#orchGlow)"/>
          <text x="700" y="28" text-anchor="middle" fill="#F59E0B" font-size="15" font-weight="800" letter-spacing="3">ORCHESTRATOR</text>
          <text x="700" y="44" text-anchor="middle" fill="#F59E0B" font-size="11" font-weight="400" opacity="0.7" data-i18n-svg="orch_desc">routes every request &middot; manages sessions &middot; handles deviations</text>

          <!-- Dashed lines from orchestrator down to pipeline -->
          <line x1="140" y1="52" x2="140" y2="90" stroke="rgba(245,158,11,0.2)" stroke-width="1" stroke-dasharray="4 3"/>
          <line x1="350" y1="52" x2="350" y2="90" stroke="rgba(245,158,11,0.2)" stroke-width="1" stroke-dasharray="4 3"/>
          <line x1="560" y1="52" x2="560" y2="90" stroke="rgba(245,158,11,0.2)" stroke-width="1" stroke-dasharray="4 3"/>
          <line x1="770" y1="52" x2="770" y2="90" stroke="rgba(245,158,11,0.2)" stroke-width="1" stroke-dasharray="4 3"/>
          <line x1="980" y1="52" x2="980" y2="90" stroke="rgba(245,158,11,0.2)" stroke-width="1" stroke-dasharray="4 3"/>
          <line x1="1200" y1="52" x2="1200" y2="90" stroke="rgba(245,158,11,0.2)" stroke-width="1" stroke-dasharray="4 3"/>

          <!-- ===== PIPELINE NODES ===== -->

          <!-- GF-WU (stacked top) -->
          <g class="pipeline-node" data-agent="greenfield-wu">
            <rect x="30" y="80" width="110" height="32" rx="8" fill="rgba(59,130,246,0.08)" stroke="#3B82F6" stroke-width="1"/>
            <text x="85" y="100" text-anchor="middle" fill="#e2e8f0" font-size="13" font-weight="600">Greenfield WU</text>
          </g>
          <rect x="58" y="115" width="48" height="14" rx="4" fill="rgba(34,211,238,0.12)"/>
          <text x="82" y="125" text-anchor="middle" fill="#22d3ee" font-size="10" font-weight="700">HAIKU</text>

          <!-- BF-WU (stacked bottom) -->
          <g class="pipeline-node" data-agent="brownfield-wu">
            <rect x="30" y="135" width="110" height="32" rx="8" fill="rgba(59,130,246,0.08)" stroke="#3B82F6" stroke-width="1"/>
            <text x="85" y="155" text-anchor="middle" fill="#e2e8f0" font-size="13" font-weight="600">Brownfield WU</text>
          </g>
          <rect x="58" y="170" width="42" height="14" rx="4" fill="rgba(244,114,182,0.12)"/>
          <text x="79" y="180" text-anchor="middle" fill="#f472b6" font-size="10" font-weight="700">OPUS</text>

          <!-- WU to Brief connections -->
          <path d="M140,96 Q170,96 185,115" stroke="#3B82F6" stroke-width="1.5" fill="none" class="dash-line" opacity="0.5"/>
          <path d="M140,151 Q170,151 185,132" stroke="#3B82F6" stroke-width="1.5" fill="none" class="dash-line" opacity="0.5"/>

          <!-- Brief -->
          <g class="pipeline-node" data-agent="brief">
            <rect x="185" y="108" width="90" height="32" rx="8" fill="rgba(59,130,246,0.08)" stroke="#3B82F6" stroke-width="1"/>
            <text x="230" y="128" text-anchor="middle" fill="#e2e8f0" font-size="14" font-weight="600">Brief</text>
          </g>
          <rect x="206" y="143" width="48" height="14" rx="4" fill="rgba(167,139,250,0.12)"/>
          <text x="230" y="153" text-anchor="middle" fill="#a78bfa" font-size="10" font-weight="700">SONNET</text>

          <!-- Brief to Parallel fan-out (curved) -->
          <path d="M275,124 Q310,90 340,90" stroke="#3B82F6" stroke-width="1.5" fill="none" class="dash-line" opacity="0.5"/>
          <path d="M275,124 Q310,124 340,124" stroke="#3B82F6" stroke-width="1.5" fill="none" class="dash-line" opacity="0.5"/>
          <path d="M275,124 Q310,158 340,158" stroke="#3B82F6" stroke-width="1.5" fill="none" class="dash-line" opacity="0.5"/>

          <!-- Parallel group bracket -->
          <rect x="330" y="70" width="140" height="108" rx="8" fill="none" stroke="rgba(59,130,246,0.2)" stroke-width="1" stroke-dasharray="4 3"/>
          <text x="400" y="192" text-anchor="middle" fill="#3B82F6" font-size="11" font-weight="700" letter-spacing="1">PARALLEL</text>

          <!-- Detail -->
          <g class="pipeline-node" data-agent="detail">
            <rect x="340" y="76" width="120" height="28" rx="8" fill="rgba(59,130,246,0.08)" stroke="#3B82F6" stroke-width="1"/>
            <text x="400" y="94" text-anchor="middle" fill="#e2e8f0" font-size="13" font-weight="600">Detail</text>
          </g>

          <!-- Architect -->
          <g class="pipeline-node" data-agent="architect">
            <rect x="340" y="110" width="120" height="28" rx="8" fill="rgba(59,130,246,0.08)" stroke="#3B82F6" stroke-width="1"/>
            <text x="400" y="128" text-anchor="middle" fill="#e2e8f0" font-size="13" font-weight="600">Architect</text>
          </g>

          <!-- UX -->
          <g class="pipeline-node" data-agent="ux">
            <rect x="340" y="144" width="120" height="28" rx="8" fill="rgba(59,130,246,0.08)" stroke="#3B82F6" stroke-width="1"/>
            <text x="400" y="162" text-anchor="middle" fill="#e2e8f0" font-size="13" font-weight="600">UX</text>
          </g>

          <!-- Model badges for parallel group -->
          <rect x="465" y="80" width="42" height="13" rx="4" fill="rgba(244,114,182,0.12)"/>
          <text x="486" y="90" text-anchor="middle" fill="#f472b6" font-size="9" font-weight="700">OPUS</text>
          <rect x="465" y="114" width="42" height="13" rx="4" fill="rgba(244,114,182,0.12)"/>
          <text x="486" y="124" text-anchor="middle" fill="#f472b6" font-size="9" font-weight="700">OPUS</text>
          <rect x="465" y="148" width="48" height="13" rx="4" fill="rgba(167,139,250,0.12)"/>
          <text x="489" y="158" text-anchor="middle" fill="#a78bfa" font-size="9" font-weight="700">SONNET</text>

          <!-- Parallel fan-in to Phases (curved) -->
          <path d="M460,90 Q490,90 520,124" stroke="#3B82F6" stroke-width="1.5" fill="none" class="dash-line" opacity="0.5"/>
          <path d="M460,124 Q490,124 520,124" stroke="#3B82F6" stroke-width="1.5" fill="none" class="dash-line" opacity="0.5"/>
          <path d="M460,158 Q490,158 520,124" stroke="#3B82F6" stroke-width="1.5" fill="none" class="dash-line" opacity="0.5"/>

          <!-- Phases -->
          <g class="pipeline-node" data-agent="phases">
            <rect x="520" y="108" width="100" height="32" rx="8" fill="rgba(59,130,246,0.08)" stroke="#3B82F6" stroke-width="1"/>
            <text x="570" y="128" text-anchor="middle" fill="#e2e8f0" font-size="14" font-weight="600">Phases</text>
          </g>
          <rect x="546" y="143" width="48" height="14" rx="4" fill="rgba(167,139,250,0.12)"/>
          <text x="570" y="153" text-anchor="middle" fill="#a78bfa" font-size="10" font-weight="700">SONNET</text>

          <!-- Phases to Tasks -->
          <line x1="620" y1="124" x2="650" y2="124" stroke="#3B82F6" stroke-width="1.5" class="dash-line" opacity="0.5"/>

          <!-- Tasks -->
          <g class="pipeline-node" data-agent="tasks">
            <rect x="650" y="108" width="100" height="32" rx="8" fill="rgba(59,130,246,0.08)" stroke="#3B82F6" stroke-width="1"/>
            <text x="700" y="128" text-anchor="middle" fill="#e2e8f0" font-size="14" font-weight="600">Tasks</text>
          </g>
          <rect x="676" y="143" width="48" height="14" rx="4" fill="rgba(167,139,250,0.12)"/>
          <text x="700" y="153" text-anchor="middle" fill="#a78bfa" font-size="10" font-weight="700">SONNET</text>

          <!-- Tasks to QA-Planning -->
          <line x1="750" y1="124" x2="790" y2="124" stroke="#8B5CF6" stroke-width="1.5" class="dash-line" opacity="0.5"/>

          <!-- ===== QA-PLANNING GATE ===== -->
          <g class="pipeline-node" data-agent="qa-planning">
            <rect x="790" y="96" width="110" height="56" rx="10" fill="rgba(139,92,246,0.1)" stroke="#8B5CF6" stroke-width="2"/>
            <text x="845" y="118" text-anchor="middle" fill="#8B5CF6" font-size="12" font-weight="700">QA-Planning</text>
            <text x="845" y="136" text-anchor="middle" fill="#a78bfa" font-size="16">&#9741;</text>
          </g>
          <text x="845" y="165" text-anchor="middle" fill="#8B5CF6" font-size="11" font-weight="600" opacity="0.8">&ge; 95%</text>
          <rect x="824" y="170" width="42" height="13" rx="4" fill="rgba(244,114,182,0.12)"/>
          <text x="845" y="180" text-anchor="middle" fill="#f472b6" font-size="9" font-weight="700">OPUS</text>

          <!-- QA-Planning to Dev -->
          <line x1="900" y1="124" x2="940" y2="124" stroke="#10B981" stroke-width="1.5" class="dash-line" opacity="0.5"/>

          <!-- ===== DEV (BUILD) ===== -->
          <g class="pipeline-node" data-agent="dev">
            <rect x="940" y="108" width="100" height="32" rx="8" fill="rgba(16,185,129,0.08)" stroke="#10B981" stroke-width="1"/>
            <text x="990" y="128" text-anchor="middle" fill="#e2e8f0" font-size="14" font-weight="600">Dev</text>
          </g>
          <rect x="969" y="143" width="42" height="14" rx="4" fill="rgba(244,114,182,0.12)"/>
          <text x="990" y="153" text-anchor="middle" fill="#f472b6" font-size="10" font-weight="700">OPUS</text>

          <!-- Dev to QA-Implementation -->
          <line x1="1040" y1="124" x2="1080" y2="124" stroke="#8B5CF6" stroke-width="1.5" class="dash-line" opacity="0.5"/>

          <!-- ===== QA-IMPLEMENTATION GATE ===== -->
          <g class="pipeline-node" data-agent="qa-implementation">
            <rect x="1080" y="96" width="110" height="56" rx="10" fill="rgba(139,92,246,0.1)" stroke="#8B5CF6" stroke-width="2"/>
            <text x="1135" y="118" text-anchor="middle" fill="#8B5CF6" font-size="12" font-weight="700">QA-Impl</text>
            <text x="1135" y="136" text-anchor="middle" fill="#a78bfa" font-size="16">&#9741;</text>
          </g>
          <text x="1135" y="165" text-anchor="middle" fill="#8B5CF6" font-size="11" font-weight="600" opacity="0.8">&ge; 90%</text>
          <rect x="1114" y="170" width="42" height="13" rx="4" fill="rgba(244,114,182,0.12)"/>
          <text x="1135" y="180" text-anchor="middle" fill="#f472b6" font-size="9" font-weight="700">OPUS</text>

          <!-- QA-Implementation to DevOps -->
          <line x1="1190" y1="124" x2="1230" y2="124" stroke="#F59E0B" stroke-width="1.5" class="dash-line" opacity="0.5"/>

          <!-- ===== DEVOPS (DEPLOY) ===== -->
          <g class="pipeline-node" data-agent="devops">
            <rect x="1230" y="108" width="110" height="32" rx="8" fill="rgba(245,158,11,0.08)" stroke="#F59E0B" stroke-width="1"/>
            <text x="1285" y="128" text-anchor="middle" fill="#e2e8f0" font-size="14" font-weight="600">DevOps</text>
          </g>
          <rect x="1261" y="143" width="48" height="14" rx="4" fill="rgba(167,139,250,0.12)"/>
          <text x="1285" y="153" text-anchor="middle" fill="#a78bfa" font-size="10" font-weight="700">SONNET</text>

          <!-- ===== PHASE LABELS AT BOTTOM ===== -->
          <line x1="30" y1="210" x2="275" y2="210" stroke="rgba(59,130,246,0.15)" stroke-width="1"/>
          <text x="152" y="225" text-anchor="middle" fill="#3B82F6" font-size="13" font-weight="700" letter-spacing="2" opacity="0.6">DISCOVER</text>

          <line x1="330" y1="210" x2="760" y2="210" stroke="rgba(99,102,241,0.15)" stroke-width="1"/>
          <text x="545" y="225" text-anchor="middle" fill="#6366F1" font-size="13" font-weight="700" letter-spacing="2" opacity="0.6">PLAN</text>

          <line x1="940" y1="210" x2="1040" y2="210" stroke="rgba(16,185,129,0.15)" stroke-width="1"/>
          <text x="990" y="225" text-anchor="middle" fill="#10B981" font-size="13" font-weight="700" letter-spacing="2" opacity="0.6">BUILD</text>

          <line x1="1230" y1="210" x2="1340" y2="210" stroke="rgba(245,158,11,0.15)" stroke-width="1"/>
          <text x="1285" y="225" text-anchor="middle" fill="#F59E0B" font-size="13" font-weight="700" letter-spacing="2" opacity="0.6">DEPLOY</text>
        </svg>
      </div>
    </div>
    <div class="pipeline-tooltip" id="pipelineTooltip"></div>
  </section>

  <!-- ===== 4. THE AGENTS ===== -->
  <section class="section" id="agents">
    <div class="section-label reveal" data-i18n="agents_label">The Team</div>
    <h2 class="section-title reveal" data-i18n="agents_title">Thirteen Agents</h2>
    <p class="section-subtitle reveal" data-i18n="agents_subtitle">Each agent has exclusive authority, a defined scope, and strict boundaries. Click any card to explore its full specification.</p>

    <div id="agentsContainer"></div>
  </section>

  <!-- ===== 5. PRISM CONTEXT ENGINE ===== -->
  <section class="section" id="prism">
    <div class="section-label reveal" data-i18n="prism_label">Context Intelligence</div>
    <h2 class="section-title reveal" data-i18n="prism_title">PRISM Context Engine</h2>
    <p class="section-subtitle reveal" data-i18n="prism_subtitle">Think of PRISM as a smart waiter: it serves each agent only the information it needs, nothing more. Five layers, from universal rules to specific task details, loaded automatically.</p>

    <div class="prism-layout">
      <div class="prism-pyramid reveal">
        <div class="prism-layer prism-layer-l4">
          <div class="prism-layer-tag">L4 <span class="prism-conditional-badge" data-i18n="prism_conditional">Conditional</span></div>
          <div class="prism-layer-name" data-i18n="prism_l4_name">Task Details</div>
          <div class="prism-layer-desc" data-i18n="prism_l4_desc">What's the specific task? Its requirements, success criteria, and what it depends on.</div>
        </div>
        <div class="prism-layer prism-layer-l3">
          <div class="prism-layer-tag">L3 <span class="prism-conditional-badge" data-i18n="prism_conditional">Conditional</span></div>
          <div class="prism-layer-name" data-i18n="prism_l3_name">Session Progress</div>
          <div class="prism-layer-desc" data-i18n="prism_l3_desc">Where are we in the project? What the previous agents produced and decided.</div>
        </div>
        <div class="prism-layer prism-layer-l2">
          <div class="prism-layer-tag">L2 <span class="prism-conditional-badge" data-i18n="prism_conditional">Conditional</span></div>
          <div class="prism-layer-name" data-i18n="prism_l2_name">Agent Rules</div>
          <div class="prism-layer-desc" data-i18n="prism_l2_desc">What can this agent do? Its permissions, boundaries, and area of expertise.</div>
        </div>
        <div class="prism-layer prism-layer-l1">
          <div class="prism-layer-tag">L1 <span class="prism-always-badge" data-i18n="prism_always">Always</span></div>
          <div class="prism-layer-name" data-i18n="prism_l1_name">Global Settings</div>
          <div class="prism-layer-desc" data-i18n="prism_l1_desc">Which mode are we in (Planning/Build/Deploy)? Plus shared rules all agents follow.</div>
        </div>
        <div class="prism-layer prism-layer-l0">
          <div class="prism-layer-tag">L0 <span class="prism-always-badge" data-i18n="prism_always">Always</span></div>
          <div class="prism-layer-name" data-i18n="prism_l0_name">Constitution</div>
          <div class="prism-layer-desc" data-i18n="prism_l0_desc">The non-negotiable foundation: 4 principles, 17 articles, 8 protocols that never change.</div>
        </div>
      </div>

      <div class="context-meter reveal reveal-delay-2">
        <div class="context-meter-title" data-i18n="ctx_bracket">Context Bracket</div>
        <div class="meter-bar-container">
          <div class="meter-zone meter-zone-fresh"></div>
          <div class="meter-zone meter-zone-moderate"></div>
          <div class="meter-zone meter-zone-depleted"></div>
          <div class="meter-zone meter-zone-critical"></div>
          <div class="meter-indicator" id="meterIndicator" style="top: 10%;"></div>
        </div>
        <div class="bracket-list">
          <div class="bracket-item">
            <span class="bracket-dot fresh"></span>
            <span class="bracket-name">FRESH</span>
            <span class="bracket-desc" data-i18n="bracket_fresh">Conversation just started  all information available</span>
          </div>
          <div class="bracket-item">
            <span class="bracket-dot moderate"></span>
            <span class="bracket-name">MODERATE</span>
            <span class="bracket-desc" data-i18n="bracket_moderate">Conversation getting longer  details are summarized</span>
          </div>
          <div class="bracket-item">
            <span class="bracket-dot depleted"></span>
            <span class="bracket-name">DEPLETED</span>
            <span class="bracket-desc" data-i18n="bracket_depleted">Running low on space  only essentials kept</span>
          </div>
          <div class="bracket-item">
            <span class="bracket-dot critical"></span>
            <span class="bracket-name">CRITICAL</span>
            <span class="bracket-desc" data-i18n="bracket_critical">Almost out of space  save progress and start fresh</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Mode Governance -->
    <div class="mode-cards">
      <div class="mode-card reveal reveal-delay-1">
        <div class="mode-card-title" style="color: var(--planning);" data-i18n="mode_planning">PLANNING Mode</div>
        <div class="mode-scope-label" data-i18n="mode_read">Read Scope</div>
        <div class="mode-scope-value">chati.dev/ + .chati/</div>
        <div class="mode-scope-label" data-i18n="mode_write">Write Scope</div>
        <div class="mode-scope-value">chati.dev/ + .chati/</div>
        <div class="mode-scope-label" data-i18n="mode_blocked">Blocked</div>
        <div class="mode-scope-value" data-i18n="mode_planning_blocked">Source code, infrastructure</div>
      </div>
      <div class="mode-card reveal reveal-delay-2">
        <div class="mode-card-title" style="color: var(--build);" data-i18n="mode_build">BUILD Mode</div>
        <div class="mode-scope-label" data-i18n="mode_read">Read Scope</div>
        <div class="mode-scope-value" data-i18n="mode_build_read">Full project access</div>
        <div class="mode-scope-label" data-i18n="mode_write">Write Scope</div>
        <div class="mode-scope-value" data-i18n="mode_build_write">Full project access</div>
        <div class="mode-scope-label" data-i18n="mode_blocked">Blocked</div>
        <div class="mode-scope-value" data-i18n="mode_build_blocked">Infrastructure, deployment</div>
      </div>
      <div class="mode-card reveal reveal-delay-3">
        <div class="mode-card-title" style="color: var(--deploy);" data-i18n="mode_deploy">DEPLOY Mode</div>
        <div class="mode-scope-label" data-i18n="mode_read">Read Scope</div>
        <div class="mode-scope-value" data-i18n="mode_deploy_read">Full + infrastructure</div>
        <div class="mode-scope-label" data-i18n="mode_write">Write Scope</div>
        <div class="mode-scope-value" data-i18n="mode_deploy_write">Full + infra configs</div>
        <div class="mode-scope-label" data-i18n="mode_blocked">Blocked</div>
        <div class="mode-scope-value" data-i18n="mode_deploy_blocked">Architecture redesign</div>
      </div>
    </div>
  </section>

  <!-- ===== 6. HOOKS SYSTEM ===== -->
  <section class="section" id="hooks">
    <div class="section-label reveal" data-i18n="hooks_label">Runtime Enforcement</div>
    <h2 class="section-title reveal" data-i18n="hooks_title">Hooks System</h2>
    <p class="section-subtitle reveal" data-i18n="hooks_subtitle">Five hooks intercept Claude Code events in real time. They enforce context loading, model selection, file access, constitutional compliance, and session memory.</p>

    <div class="hooks-timeline">
      <div class="hook-card reveal reveal-delay-1" data-hook="prism">
        <div class="hook-dot"></div>
        <div class="hook-trigger">UserPromptSubmit</div>
        <h3 class="hook-name" data-i18n="hook_prism_name">PRISM Engine</h3>
        <p class="hook-description" data-i18n="hook_prism_desc">Intercepts every user message. Loads the correct PRISM layers based on active agent, mode, and pipeline state. Injects context into the system prompt before the model processes it.</p>
        <span class="hook-enforcement block">BLOCK</span>
      </div>
      <div class="hook-card reveal reveal-delay-2" data-hook="model">
        <div class="hook-dot"></div>
        <div class="hook-trigger">UserPromptSubmit</div>
        <h3 class="hook-name" data-i18n="hook_model_name">Model Governance</h3>
        <p class="hook-description" data-i18n="hook_model_desc">Validates that the correct Claude model (Haiku, Sonnet, or Opus) is being used for the active agent. Prevents cost overruns and ensures appropriate reasoning power for each task.</p>
        <span class="hook-enforcement advisory">ADVISORY</span>
      </div>
      <div class="hook-card reveal reveal-delay-3" data-hook="mode">
        <div class="hook-dot"></div>
        <div class="hook-trigger">PreToolUse (Write/Edit)</div>
        <h3 class="hook-name" data-i18n="hook_mode_name">Mode Governance</h3>
        <p class="hook-description" data-i18n="hook_mode_desc">Intercepts all file write and edit operations. Validates the target path against the current mode's allowed scope. Blocks PLANNING agents from touching source code. Blocks BUILD agents from modifying infrastructure.</p>
        <span class="hook-enforcement block">BLOCK</span>
      </div>
      <div class="hook-card reveal reveal-delay-4" data-hook="constitution">
        <div class="hook-dot"></div>
        <div class="hook-trigger">PreToolUse (Write/Edit)</div>
        <h3 class="hook-name" data-i18n="hook_const_name">Constitution Guard</h3>
        <p class="hook-description" data-i18n="hook_const_desc">Protects the constitution and framework files from unauthorized modification. Ensures immutability of core rules. Only the Orchestrator in specific conditions can modify protected files.</p>
        <span class="hook-enforcement block">BLOCK</span>
      </div>
      <div class="hook-card reveal reveal-delay-5" data-hook="session">
        <div class="hook-dot"></div>
        <div class="hook-trigger">PreCompact</div>
        <h3 class="hook-name" data-i18n="hook_session_name">Session Digest</h3>
        <p class="hook-description" data-i18n="hook_session_desc">Fires before Claude Code compacts the conversation window. Captures critical session state, decisions, and progress into a digest file so context survives compaction cycles.</p>
        <span class="hook-enforcement advisory">ADVISORY</span>
      </div>
    </div>
  </section>

  <!-- ===== 7. CONSTITUTION ===== -->
  <section class="section" id="constitution">
    <div class="section-label reveal" data-i18n="const_label">Immutable Foundation</div>
    <h2 class="section-title reveal" data-i18n="const_title">The Constitution</h2>
    <p class="section-subtitle reveal" data-i18n="const_subtitle">Four principles, seventeen articles, eight protocols. The rules every agent must follow, enforced at runtime by the Constitution Guard hook.</p>

    <!-- Core Principles -->
    <div class="constitution-principles">
      <div class="principle-card reveal reveal-delay-1">
        <div class="principle-number">I</div>
        <h3 class="principle-title" data-i18n="principle_1_title">Structured Discovery & Planning</h3>
        <p class="principle-desc" data-i18n="principle_1_desc">Every project passes through DISCOVER and PLAN before any code is written. No shortcuts, no exceptions.</p>
      </div>
      <div class="principle-card reveal reveal-delay-2">
        <div class="principle-number">II</div>
        <h3 class="principle-title" data-i18n="principle_2_title">Agent Sovereignty</h3>
        <p class="principle-desc" data-i18n="principle_2_desc">Each agent has exclusive authority over its domain. No agent may override another's decisions.</p>
      </div>
      <div class="principle-card reveal reveal-delay-3">
        <div class="principle-number">III</div>
        <h3 class="principle-title" data-i18n="principle_3_title">Quality Gates</h3>
        <p class="principle-desc" data-i18n="principle_3_desc">Transitions between phases require passing quality gates with quantified thresholds.</p>
      </div>
      <div class="principle-card reveal reveal-delay-4">
        <div class="principle-number">IV</div>
        <h3 class="principle-title" data-i18n="principle_4_title">Traceability</h3>
        <p class="principle-desc" data-i18n="principle_4_desc">Every artifact traces back to a requirement. Every decision is documented and auditable.</p>
      </div>
    </div>

    <!-- 17 Articles -->
    <div class="articles-grid" id="articlesGrid">
      <!-- Populated by JS -->
    </div>

    <!-- Protocols -->
    <h3 class="protocols-section-title reveal" data-i18n="protocols_title">Universal Protocols</h3>
    <div class="protocols-grid" id="protocolsGrid">
      <!-- Populated by JS -->
    </div>
  </section>

  <!-- ===== 8. MEMORY & QUALITY ===== -->
  <section class="section" id="memory-quality">
    <div class="section-label reveal" data-i18n="mq_label">Intelligence & Assurance</div>
    <h2 class="section-title reveal" data-i18n="mq_title">Memory & Quality</h2>
    <p class="section-subtitle reveal" data-i18n="mq_subtitle">Persistent memory across sessions. Four-tier validation before deployment. Two-layer handoff on every agent transition.</p>

    <div class="memory-quality-grid">
      <!-- LEFT: Memory -->
      <div class="reveal">
        <h3 class="mq-section-title" data-i18n="mq_memory_title">Cognitive Memory</h3>
        <div class="cognitive-sectors">
          <div class="sector-card" style="border-left: 3px solid var(--planning);">
            <div class="sector-icon" style="color: var(--planning);">&#9673;</div>
            <div class="sector-name" data-i18n="sector_episodic">Episodic</div>
            <div class="sector-desc" data-i18n="sector_episodic_desc">Session history, decisions made, context from prior conversations</div>
          </div>
          <div class="sector-card" style="border-left: 3px solid var(--build);">
            <div class="sector-icon" style="color: var(--build);">&#9670;</div>
            <div class="sector-name" data-i18n="sector_semantic">Semantic</div>
            <div class="sector-desc" data-i18n="sector_semantic_desc">Project knowledge, codebase patterns, architectural constraints</div>
          </div>
          <div class="sector-card" style="border-left: 3px solid var(--quality);">
            <div class="sector-icon" style="color: var(--quality);">&#9672;</div>
            <div class="sector-name" data-i18n="sector_procedural">Procedural</div>
            <div class="sector-desc" data-i18n="sector_procedural_desc">Learned workflows, automation patterns, optimization strategies</div>
          </div>
          <div class="sector-card" style="border-left: 3px solid var(--deploy);">
            <div class="sector-icon" style="color: var(--deploy);">&#9671;</div>
            <div class="sector-name" data-i18n="sector_reflective">Reflective</div>
            <div class="sector-desc" data-i18n="sector_reflective_desc">Self-assessment, quality trends, improvement recommendations</div>
          </div>
        </div>

        <h4 style="font-size: 15px; font-weight: 600; margin-bottom: 12px;" data-i18n="attention_tiers">Attention Tiers</h4>
        <div class="tier-list">
          <div class="tier-item">
            <span class="tier-label hot">HOT</span>
            <span class="tier-desc" data-i18n="tier_hot">Active session context, loaded into every prompt</span>
          </div>
          <div class="tier-item">
            <span class="tier-label warm">WARM</span>
            <span class="tier-desc" data-i18n="tier_warm">Recent sessions, loaded on demand when needed</span>
          </div>
          <div class="tier-item">
            <span class="tier-label cold">COLD</span>
            <span class="tier-desc" data-i18n="tier_cold">Older context, referenced only when explicitly needed</span>
          </div>
          <div class="tier-item">
            <span class="tier-label archive">ARCHIVE</span>
            <span class="tier-desc" data-i18n="tier_archive">Compressed digests, available for historical analysis</span>
          </div>
        </div>
      </div>

      <!-- RIGHT: Quality -->
      <div class="reveal reveal-delay-2">
        <h3 class="mq-section-title" data-i18n="mq_quality_title">Quality Thresholds</h3>
        <table class="quality-table">
          <thead>
            <tr>
              <th data-i18n="qt_gate">Gate</th>
              <th data-i18n="qt_threshold">Threshold</th>
              <th data-i18n="qt_enforcement">Enforcement</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>QA-Planning</td>
              <td style="color: var(--quality); font-weight: 600;">&ge; 95%</td>
              <td><span class="enforcement-badge block">BLOCK</span></td>
            </tr>
            <tr>
              <td>QA-Implementation</td>
              <td style="color: var(--quality); font-weight: 600;">&ge; 90%</td>
              <td><span class="enforcement-badge block">BLOCK</span></td>
            </tr>
            <tr>
              <td data-i18n="qt_test_coverage">Test Coverage</td>
              <td style="color: var(--quality); font-weight: 600;">&ge; 80%</td>
              <td><span class="enforcement-badge warn">WARN</span></td>
            </tr>
            <tr>
              <td>SAST Critical</td>
              <td style="color: var(--quality); font-weight: 600;" data-i18n="qt_zero_findings">0 findings</td>
              <td><span class="enforcement-badge block">BLOCK</span></td>
            </tr>
            <tr>
              <td>Lint Warnings</td>
              <td style="color: var(--quality); font-weight: 600;" data-i18n="qt_zero_warnings">0 warnings</td>
              <td><span class="enforcement-badge warn">WARN</span></td>
            </tr>
          </tbody>
        </table>

        <h4 style="font-size: 15px; font-weight: 600; margin-bottom: 12px;" data-i18n="handoff_title">Two-Layer Handoff Protocol</h4>
        <div class="handoff-viz">
          <div class="handoff-layer" style="border-left: 3px solid var(--prism);">
            <div class="handoff-layer-title" style="color: var(--prism);" data-i18n="handoff_l1_title">Layer 1: Structured Handoff</div>
            <div class="handoff-layer-desc" data-i18n="handoff_l1_desc">Machine-readable YAML written to session.yaml. Contains agent state, pipeline position, outputs produced, decisions made, and blockers encountered. Persisted immediately on every transition.</div>
          </div>
          <div class="handoff-layer" style="border-left: 3px solid var(--planning);">
            <div class="handoff-layer-title" style="color: var(--planning);" data-i18n="handoff_l2_title">Layer 2: Narrative Handoff</div>
            <div class="handoff-layer-desc" data-i18n="handoff_l2_desc">Human-readable document written to docs/sessions/. Contains context summary, reasoning behind decisions, open questions, and recommended next steps for the receiving agent.</div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Agent Modal Overlay -->
  <div class="agent-modal-overlay" id="agentModalOverlay" onclick="if(event.target===this)closeAgentModal()">
    <div class="agent-modal" id="agentModal">
      <button class="agent-modal-close" onclick="closeAgentModal()">&times;</button>
      <div id="agentModalContent"></div>
    </div>
  </div>

  <!-- ===== 9. FOOTER ===== -->
  <footer class="footer">
    <div class="footer-brand" data-i18n="footer_brand">Built with Chati.dev</div>
    <div class="footer-version">v2.0 Orion &middot; 13 Agents &middot; 5 PRISM Layers &middot; 17 Constitution Articles</div>
    <div class="footer-links">
      <a href="https://github.com/vyndhub/chati.dev" class="footer-link" target="_blank" rel="noopener">GitHub</a>
      <a href="https://www.npmjs.com/package/chati.dev" class="footer-link" target="_blank" rel="noopener">npm</a>
    </div>
  </footer>
  <script>
    /* ===== TRANSLATIONS ===== */
    const translations = {
      en: {
        nav_home: 'Home',
        nav_how: 'How It Works',
        nav_pipeline: 'Pipeline',
        nav_agents: 'Agents',
        nav_constitution: 'Constitution',
        nav_memory: 'Memory',
        hero_subtitle: 'AI-Orchestrated Development System',
        stat_agents: 'Agents',
        stat_prism: 'PRISM Layers',
        stat_articles: 'Constitution Articles',
        stat_workflows: 'Workflows',
        how_label: 'The Process',
        how_title: 'How It Works',
        how_subtitle: 'Four phases. Thirteen agents. One unified pipeline that transforms ideas into production-ready software.',
        how_discover_desc: 'We discover before we plan. Three agents analyze the operational landscape, detect tech stacks, and extract requirements before any design begins.',
        how_discover_badge: '3 Agents',
        how_plan_desc: 'Five agents transform requirements into architecture, UX, phases, and atomic tasks. Every artifact is validated and feeds the next.',
        how_plan_badge: '5 Agents',
        how_build_desc: 'One agent implements with surgical precision. Self-critique protocol catches bugs before tests run. Quality gate validates everything against acceptance criteria.',
        how_build_badge: '1 Agent',
        how_deploy_desc: 'Automated deployment with rollback procedures. Documentation generated. CI/CD configured. Monitoring in place before anything reaches production.',
        how_deploy_badge: '1 Agent',
        pipeline_label: 'Architecture',
        pipeline_title: 'The Pipeline',
        pipeline_subtitle: 'Every request flows through a validated pipeline. Quality gates enforce thresholds. No shortcuts allowed.',
        agents_label: 'The Team',
        agents_title: 'Thirteen Agents',
        agents_subtitle: 'Each agent has exclusive authority, a defined scope, and strict boundaries. Click any card to explore its full specification.',
        prism_label: 'Context Intelligence',
        prism_title: 'PRISM Context Engine',
        prism_subtitle: 'Think of PRISM as a smart waiter: it serves each agent only the information it needs, nothing more. Five layers, from universal rules to specific task details, loaded automatically.',
        prism_conditional: 'Conditional',
        prism_always: 'Always',
        prism_l4_name: 'Task Details',
        prism_l4_desc: 'What\'s the specific task? Its requirements, success criteria, and what it depends on.',
        prism_l3_name: 'Session Progress',
        prism_l3_desc: 'Where are we in the project? What the previous agents produced and decided.',
        prism_l2_name: 'Agent Rules',
        prism_l2_desc: 'What can this agent do? Its permissions, boundaries, and area of expertise.',
        prism_l1_name: 'Global Settings',
        prism_l1_desc: 'Which mode are we in (Planning/Build/Deploy)? Plus shared rules all agents follow.',
        prism_l0_name: 'Constitution',
        prism_l0_desc: 'The non-negotiable foundation: 4 principles, 17 articles, 8 protocols that never change.',
        ctx_bracket: 'Context Bracket',
        bracket_fresh: 'Conversation just started  all information available',
        bracket_moderate: 'Conversation getting longer  details are summarized',
        bracket_depleted: 'Running low on space  only essentials kept',
        bracket_critical: 'Almost out of space  save progress and start fresh',
        mode_planning: 'PLANNING Mode',
        mode_build: 'BUILD Mode',
        mode_deploy: 'DEPLOY Mode',
        mode_read: 'Read Scope',
        mode_write: 'Write Scope',
        mode_blocked: 'Blocked',
        mode_planning_blocked: 'Source code, infrastructure',
        mode_build_read: 'Full project access',
        mode_build_write: 'Full project access',
        mode_build_blocked: 'Infrastructure, deployment',
        mode_deploy_read: 'Full + infrastructure',
        mode_deploy_write: 'Full + infra configs',
        mode_deploy_blocked: 'Architecture redesign',
        hooks_label: 'Runtime Enforcement',
        hooks_title: 'Hooks System',
        hooks_subtitle: 'Five hooks intercept Claude Code events in real time. They enforce context loading, model selection, file access, constitutional compliance, and session memory.',
        hook_prism_name: 'PRISM Engine',
        hook_prism_desc: 'Intercepts every user message. Loads the correct PRISM layers based on active agent, mode, and pipeline state. Injects context into the system prompt before the model processes it.',
        hook_model_name: 'Model Governance',
        hook_model_desc: 'Validates that the correct Claude model (Haiku, Sonnet, or Opus) is being used for the active agent. Prevents cost overruns and ensures appropriate reasoning power for each task.',
        hook_mode_name: 'Mode Governance',
        hook_mode_desc: 'Intercepts all file write and edit operations. Validates the target path against the current mode\'s allowed scope. Blocks PLANNING agents from touching source code. Blocks BUILD agents from modifying infrastructure.',
        hook_const_name: 'Constitution Guard',
        hook_const_desc: 'Protects the constitution and framework files from unauthorized modification. Ensures immutability of core rules. Only the Orchestrator in specific conditions can modify protected files.',
        hook_session_name: 'Session Digest',
        hook_session_desc: 'Fires before Claude Code compacts the conversation window. Captures critical session state, decisions, and progress into a digest file so context survives compaction cycles.',
        const_label: 'Immutable Foundation',
        const_title: 'The Constitution',
        const_subtitle: 'Four principles, seventeen articles, eight protocols. The rules every agent must follow, enforced at runtime by the Constitution Guard hook.',
        principle_1_title: 'Structured Discovery & Planning',
        principle_1_desc: 'Every project passes through DISCOVER and PLAN before any code is written. No shortcuts, no exceptions.',
        principle_2_title: 'Agent Sovereignty',
        principle_2_desc: 'Each agent has exclusive authority over its domain. No agent may override another\'s decisions.',
        principle_3_title: 'Quality Gates',
        principle_3_desc: 'Transitions between phases require passing quality gates with quantified thresholds.',
        principle_4_title: 'Traceability',
        principle_4_desc: 'Every artifact traces back to a requirement. Every decision is documented and auditable.',
        protocols_title: 'Universal Protocols',
        mq_label: 'Intelligence & Assurance',
        mq_title: 'Memory & Quality',
        mq_subtitle: 'Persistent memory across sessions. Four-tier validation before deployment. Two-layer handoff on every agent transition.',
        mq_memory_title: 'Cognitive Memory',
        mq_quality_title: 'Quality Thresholds',
        sector_episodic: 'Episodic',
        sector_episodic_desc: 'Session history, decisions made, context from prior conversations',
        sector_semantic: 'Semantic',
        sector_semantic_desc: 'Project knowledge, codebase patterns, architectural constraints',
        sector_procedural: 'Procedural',
        sector_procedural_desc: 'Learned workflows, automation patterns, optimization strategies',
        sector_reflective: 'Reflective',
        sector_reflective_desc: 'Self-assessment, quality trends, improvement recommendations',
        attention_tiers: 'Attention Tiers',
        tier_hot: 'Active session context, loaded into every prompt',
        tier_warm: 'Recent sessions, loaded on demand when needed',
        tier_cold: 'Older context, referenced only when explicitly needed',
        tier_archive: 'Compressed digests, available for historical analysis',
        qt_gate: 'Gate',
        qt_threshold: 'Threshold',
        qt_enforcement: 'Enforcement',
        qt_test_coverage: 'Test Coverage',
        qt_zero_findings: '0 findings',
        qt_zero_warnings: '0 warnings',
        handoff_title: 'Two-Layer Handoff Protocol',
        handoff_l1_title: 'Layer 1: Structured Handoff',
        handoff_l1_desc: 'Machine-readable YAML written to session.yaml. Contains agent state, pipeline position, outputs produced, decisions made, and blockers encountered. Persisted immediately on every transition.',
        handoff_l2_title: 'Layer 2: Narrative Handoff',
        handoff_l2_desc: 'Human-readable document written to docs/sessions/. Contains context summary, reasoning behind decisions, open questions, and recommended next steps for the receiving agent.',
        footer_brand: 'Built with Chati.dev',
        orch_desc: 'routes every request \u00b7 manages sessions \u00b7 handles deviations'
      },
      pt: {
        nav_home: 'In\u00edcio',
        nav_how: 'Como Funciona',
        nav_pipeline: 'Pipeline',
        nav_agents: 'Agentes',
        nav_constitution: 'Constitui\u00e7\u00e3o',
        nav_memory: 'Mem\u00f3ria',
        hero_subtitle: 'Sistema de Desenvolvimento Orquestrado por IA',
        stat_agents: 'Agentes',
        stat_prism: 'Camadas PRISM',
        stat_articles: 'Artigos da Constitui\u00e7\u00e3o',
        stat_workflows: 'Workflows',
        how_label: 'O Processo',
        how_title: 'Como Funciona',
        how_subtitle: 'Quatro fases. Treze agentes. Um pipeline unificado que transforma ideias em software pronto para produ\u00e7\u00e3o.',
        how_discover_desc: 'Descobrimos antes de planejar. Tr\u00eas agentes analisam o cen\u00e1rio operacional, detectam stacks tecnol\u00f3gicos e extraem requisitos antes de qualquer design come\u00e7ar.',
        how_discover_badge: '3 Agentes',
        how_plan_desc: 'Cinco agentes transformam requisitos em arquitetura, UX, fases e tasks at\u00f4micas. Cada artefato \u00e9 validado e alimenta o pr\u00f3ximo.',
        how_plan_badge: '5 Agentes',
        how_build_desc: 'Um agente implementa com precis\u00e3o cir\u00fargica. O protocolo de autocrr\u00edtica captura bugs antes dos testes rodarem. O quality gate valida tudo contra os crit\u00e9rios de aceita\u00e7\u00e3o.',
        how_build_badge: '1 Agente',
        how_deploy_desc: 'Deploy automatizado com procedimentos de rollback. Documenta\u00e7\u00e3o gerada. CI/CD configurado. Monitoramento ativo antes que qualquer coisa chegue \u00e0 produ\u00e7\u00e3o.',
        how_deploy_badge: '1 Agente',
        pipeline_label: 'Arquitetura',
        pipeline_title: 'O Pipeline',
        pipeline_subtitle: 'Cada requisi\u00e7\u00e3o flui por um pipeline validado. Quality gates aplicam thresholds. Sem atalhos permitidos.',
        agents_label: 'O Time',
        agents_title: 'Treze Agentes',
        agents_subtitle: 'Cada agente tem autoridade exclusiva, escopo definido e limites r\u00edgidos. Clique em qualquer card para explorar sua especifica\u00e7\u00e3o completa.',
        prism_label: 'Intelig\u00eancia de Contexto',
        prism_title: 'Motor de Contexto PRISM',
        prism_subtitle: 'Pense no PRISM como um garom inteligente: ele serve a cada agente apenas as informaes que precisa, nada a mais. Cinco camadas, das regras universais at os detalhes da tarefa, carregadas automaticamente.',
        prism_conditional: 'Condicional',
        prism_always: 'Sempre',
        prism_l4_name: 'Detalhes da Tarefa',
        prism_l4_desc: 'Qual  a tarefa especfica? Seus requisitos, critrios de sucesso e do que ela depende.',
        prism_l3_name: 'Progresso da Sesso',
        prism_l3_desc: 'Onde estamos no projeto? O que os agentes anteriores produziram e decidiram.',
        prism_l2_name: 'Regras do Agente',
        prism_l2_desc: 'O que este agente pode fazer? Suas permisses, limites e rea de atuao.',
        prism_l1_name: 'Configuraes Globais',
        prism_l1_desc: 'Em qual modo estamos (Planning/Build/Deploy)? Mais as regras compartilhadas por todos.',
        prism_l0_name: 'Constituio',
        prism_l0_desc: 'A base inegocivel: 4 princpios, 17 artigos, 8 protocolos que nunca mudam.',
        ctx_bracket: 'Faixa de Contexto',
        bracket_fresh: 'Conversa acabou de comear  todas as informaes disponveis',
        bracket_moderate: 'Conversa ficando longa  detalhes so resumidos',
        bracket_depleted: 'Pouco espao sobrando  s o essencial  mantido',
        bracket_critical: 'Quase sem espao  salvar progresso e recomear',
        mode_planning: 'Modo PLANNING',
        mode_build: 'Modo BUILD',
        mode_deploy: 'Modo DEPLOY',
        mode_read: 'Escopo de Leitura',
        mode_write: 'Escopo de Escrita',
        mode_blocked: 'Bloqueado',
        mode_planning_blocked: 'C\u00f3digo fonte, infraestrutura',
        mode_build_read: 'Acesso total ao projeto',
        mode_build_write: 'Acesso total ao projeto',
        mode_build_blocked: 'Infraestrutura, deployment',
        mode_deploy_read: 'Total + infraestrutura',
        mode_deploy_write: 'Total + configs de infra',
        mode_deploy_blocked: 'Redesign de arquitetura',
        hooks_label: 'Aplica\u00e7\u00e3o em Tempo Real',
        hooks_title: 'Sistema de Hooks',
        hooks_subtitle: 'Cinco hooks interceptam eventos do Claude Code em tempo real. Eles aplicam carregamento de contexto, sele\u00e7\u00e3o de modelo, acesso a arquivos, conformidade constitucional e mem\u00f3ria de sess\u00e3o.',
        hook_prism_name: 'Motor PRISM',
        hook_prism_desc: 'Intercepta cada mensagem do usu\u00e1rio. Carrega as camadas PRISM corretas com base no agente ativo, modo e estado do pipeline. Injeta contexto no prompt do sistema antes do modelo process\u00e1-lo.',
        hook_model_name: 'Governan\u00e7a de Modelo',
        hook_model_desc: 'Valida que o modelo Claude correto (Haiku, Sonnet ou Opus) est\u00e1 sendo usado para o agente ativo. Previne custos excessivos e garante poder de racioc\u00ednio apropriado para cada tarefa.',
        hook_mode_name: 'Governan\u00e7a de Modo',
        hook_mode_desc: 'Intercepta todas as opera\u00e7\u00f5es de escrita e edi\u00e7\u00e3o de arquivos. Valida o caminho alvo contra o escopo permitido do modo atual. Bloqueia agentes PLANNING de tocar c\u00f3digo fonte. Bloqueia agentes BUILD de modificar infraestrutura.',
        hook_const_name: 'Guarda da Constitui\u00e7\u00e3o',
        hook_const_desc: 'Protege a constitui\u00e7\u00e3o e arquivos do framework contra modifica\u00e7\u00e3o n\u00e3o autorizada. Garante imutabilidade das regras centrais. Apenas o Orchestrator em condi\u00e7\u00f5es espec\u00edficas pode modificar arquivos protegidos.',
        hook_session_name: 'Digest de Sess\u00e3o',
        hook_session_desc: 'Dispara antes do Claude Code compactar a janela de conversa\u00e7\u00e3o. Captura estado cr\u00edtico da sess\u00e3o, decis\u00f5es e progresso em um arquivo digest para que o contexto sobreviva ciclos de compacta\u00e7\u00e3o.',
        const_label: 'Funda\u00e7\u00e3o Imut\u00e1vel',
        const_title: 'A Constitui\u00e7\u00e3o',
        const_subtitle: 'Quatro princ\u00edpios, dezessete artigos, oito protocolos. As regras que todo agente deve seguir, aplicadas em tempo de execu\u00e7\u00e3o pelo hook Constitution Guard.',
        principle_1_title: 'Descoberta & Planejamento Estruturado',
        principle_1_desc: 'Todo projeto passa por DISCOVER e PLAN antes que qualquer c\u00f3digo seja escrito. Sem atalhos, sem exce\u00e7\u00f5es.',
        principle_2_title: 'Soberania do Agente',
        principle_2_desc: 'Cada agente tem autoridade exclusiva sobre seu dom\u00ednio. Nenhum agente pode sobrescrever decis\u00f5es de outro.',
        principle_3_title: 'Quality Gates',
        principle_3_desc: 'Transi\u00e7\u00f5es entre fases requerem aprovacao em quality gates com thresholds quantificados.',
        principle_4_title: 'Rastreabilidade',
        principle_4_desc: 'Todo artefato tra\u00e7a de volta a um requisito. Toda decis\u00e3o \u00e9 documentada e audit\u00e1vel.',
        protocols_title: 'Protocolos Universais',
        mq_label: 'Intelig\u00eancia & Garantia',
        mq_title: 'Mem\u00f3ria & Qualidade',
        mq_subtitle: 'Mem\u00f3ria persistente entre sess\u00f5es. Valida\u00e7\u00e3o em quatro camadas antes do deploy. Handoff de duas camadas em cada transi\u00e7\u00e3o de agente.',
        mq_memory_title: 'Mem\u00f3ria Cognitiva',
        mq_quality_title: 'Thresholds de Qualidade',
        sector_episodic: 'Epis\u00f3dica',
        sector_episodic_desc: 'Hist\u00f3rico de sess\u00f5es, decis\u00f5es tomadas, contexto de conversas anteriores',
        sector_semantic: 'Sem\u00e2ntica',
        sector_semantic_desc: 'Conhecimento do projeto, padr\u00f5es do codebase, restri\u00e7\u00f5es arquiteturais',
        sector_procedural: 'Procedural',
        sector_procedural_desc: 'Workflows aprendidos, padr\u00f5es de automa\u00e7\u00e3o, estrat\u00e9gias de otimiza\u00e7\u00e3o',
        sector_reflective: 'Reflexiva',
        sector_reflective_desc: 'Autoavalia\u00e7\u00e3o, tend\u00eancias de qualidade, recomenda\u00e7\u00f5es de melhoria',
        attention_tiers: 'N\u00edveis de Aten\u00e7\u00e3o',
        tier_hot: 'Contexto de sess\u00e3o ativo, carregado em cada prompt',
        tier_warm: 'Sesses recentes, carregadas sob demanda quando necessrio',
        tier_cold: 'Contexto antigo, referenciado apenas quando explicitamente necess\u00e1rio',
        tier_archive: 'Digests comprimidos, dispon\u00edveis para an\u00e1lise hist\u00f3rica',
        qt_gate: 'Gate',
        qt_threshold: 'Threshold',
        qt_enforcement: 'Aplica\u00e7\u00e3o',
        qt_test_coverage: 'Cobertura de Testes',
        qt_zero_findings: '0 achados',
        qt_zero_warnings: '0 avisos',
        handoff_title: 'Protocolo de Handoff em Duas Camadas',
        handoff_l1_title: 'Camada 1: Handoff Estruturado',
        handoff_l1_desc: 'YAML leg\u00edvel por m\u00e1quina escrito em session.yaml. Cont\u00e9m estado do agente, posi\u00e7\u00e3o no pipeline, outputs produzidos, decis\u00f5es tomadas e bloqueios encontrados. Persistido imediatamente em cada transi\u00e7\u00e3o.',
        handoff_l2_title: 'Camada 2: Handoff Narrativo',
        handoff_l2_desc: 'Documento leg\u00edvel por humanos escrito em docs/sessions/. Cont\u00e9m resumo do contexto, racioc\u00ednio por tr\u00e1s das decis\u00f5es, quest\u00f5es em aberto e pr\u00f3ximos passos recomendados para o agente receptor.',
        footer_brand: 'Constru\u00eddo com Chati.dev',
        orch_desc: 'roteia cada requisi\u00e7\u00e3o \u00b7 gerencia sess\u00f5es \u00b7 trata desvios'
      }
    };

    let currentLang = localStorage.getItem('chati-lang') || 'en';
    let currentTheme = localStorage.getItem('chati-theme') || 'dark';

    /* ===== LANGUAGE TOGGLE ===== */
    function applyLanguage(lang) {
      currentLang = lang;
      localStorage.setItem('chati-lang', lang);
      document.querySelectorAll('[data-i18n]').forEach(function(el) {
        var key = el.getAttribute('data-i18n');
        if (translations[lang] && translations[lang][key]) {
          el.textContent = translations[lang][key];
        }
      });
      // Update SVG text
      document.querySelectorAll('[data-i18n-svg]').forEach(function(el) {
        var key = el.getAttribute('data-i18n-svg');
        if (translations[lang] && translations[lang][key]) {
          el.textContent = translations[lang][key];
        }
      });
      // Update toggle button
      var toggle = document.getElementById('langToggle');
      if (lang === 'en') {
        toggle.innerHTML = '<span class="active-lang">EN</span> | PT';
      } else {
        toggle.innerHTML = 'EN | <span class="active-lang">PT</span>';
      }
      // Re-render dynamic content with new language
      if (document.getElementById('agentsContainer')) {
        renderAgents();
        renderArticles();
        renderProtocols();
        // Re-observe reveals after re-render
        setTimeout(function() {
          document.querySelectorAll('.reveal').forEach(function(el) { revealObserver.observe(el); });
        }, 50);
        // Update pipeline tooltips
        setupPipelineTooltips();
      }
    }

    function toggleLanguage() {
      applyLanguage(currentLang === 'en' ? 'pt' : 'en');
    }

    /* ===== THEME TOGGLE ===== */
    function applyTheme(theme) {
      currentTheme = theme;
      localStorage.setItem('chati-theme', theme);
      document.documentElement.setAttribute('data-theme', theme);
      const btn = document.getElementById('themeToggle');
      btn.innerHTML = theme === 'dark' ? '&#9790;' : '&#9728;';
    }

    function toggleTheme() {
      applyTheme(currentTheme === 'dark' ? 'light' : 'dark');
    }

    /* ===== AGENT DATA ===== */
    const agents = {
      'orchestrator': {
        name: 'Orchestrator', command: '/chati', phase: 'ORCHESTRATOR', phaseKey: 'orchestrator', color: '#F59E0B',
        model: 'sonnet', upgrade: 'opus for complex routing',
        mission: 'Central router \u2014 manages pipeline, sessions, deviations, and multi-terminal coordination',
        exclusive: ['Request routing', 'Agent selection', 'Pipeline management', 'Deviation handling', 'Session management', 'Mode switching', 'Terminal spawning'],
        allowed: ['Read any file', 'Write session.yaml', 'Write handoff documents', 'Trigger quality gates'],
        blocked: ['Direct code writing', 'Architecture decisions', 'UX design', 'Deployment'],
        outputs: ['session.yaml', 'Handoff documents'],
        rules: [{id:'orch-route',text:'Route to correct agent by pipeline state'},{id:'orch-single-entry',text:'User only interacts via /chati'},{id:'orch-pipeline',text:'Respect pipeline order unless deviation'},{id:'orch-handoff',text:'Two-layer handoff on every transition'},{id:'orch-session',text:'Persist state to session.yaml immediately'}]
      },
      'greenfield-wu': {
        name: 'Greenfield WU', phase: 'DISCOVER', phaseKey: 'discover', color: '#3B82F6',
        model: 'haiku', upgrade: 'sonnet if multi-stack/enterprise',
        mission: 'Operational discovery for new projects \u2014 tech stack, scaffolding, conventions',
        exclusive: ['Greenfield analysis', 'Scaffolding detection', 'Tech stack detection', 'Convention identification'],
        allowed: ['Read package.json/config', 'Analyze structure', 'Detect IDE/tooling', 'Recommend scaffolding'],
        blocked: ['Code modification', 'Architecture decisions', 'DB schema', 'API design', 'Brownfield analysis'],
        outputs: ['wu-report.yaml'],
        rules: [{id:'gf-01',text:'MUST redirect if source code detected'},{id:'gf-02',text:'MUST analyze package.json if present'},{id:'gf-03',text:'MUST detect IDE config'},{id:'gf-04',text:'MUST NOT make architecture decisions'},{id:'gf-05',text:'MUST include scaffolding recommendations'}]
      },
      'brownfield-wu': {
        name: 'Brownfield WU', phase: 'DISCOVER', phaseKey: 'discover', color: '#3B82F6',
        model: 'opus', upgrade: 'no downgrade',
        mission: 'Deep codebase discovery \u2014 dependency scan, architecture mapping, risk assessment',
        exclusive: ['Brownfield analysis', 'Dependency graph mapping', 'Risk assessment', 'Architecture pattern detection'],
        allowed: ['Read all source code', 'Analyze dependencies', 'Detect patterns', 'Assess quality/security', 'Map DB schemas'],
        blocked: ['Code modification', 'Architecture redesign', 'New features', 'DevOps', 'Greenfield analysis'],
        outputs: ['wu-report.yaml'],
        rules: [{id:'bf-01',text:'Deep discovery MANDATORY'},{id:'bf-02',text:'Analyze entire dependency tree'},{id:'bf-03',text:'Detect architecture patterns'},{id:'bf-04',text:'MUST NOT modify code (read-only)'},{id:'bf-05',text:'Assess technical debt with risk scores'}]
      },
      'brief': {
        name: 'Brief', phase: 'DISCOVER', phaseKey: 'discover', color: '#3B82F6',
        model: 'sonnet', upgrade: 'opus if enterprise/10+ integrations',
        mission: 'Extract and validate project requirements across 5 categories',
        exclusive: ['Requirement extraction', 'Stakeholder mapping', 'Business objectives', 'Constraint identification', 'Success metrics'],
        allowed: ['Ask clarifying questions', 'Categorize requirements', 'Validate completeness', 'Identify gaps'],
        blocked: ['Code modification', 'Architecture decisions', 'PRD authoring', 'Task decomposition'],
        outputs: ['brief-report.md'],
        rules: [{id:'br-01',text:'Extract ALL 5 requirement categories'},{id:'br-02',text:'Clarify ambiguous requirements'},{id:'br-03',text:'Document all stakeholders'},{id:'br-04',text:'MUST NOT expand into PRD format'},{id:'br-05',text:'Validate metrics are measurable'}]
      },
      'detail': {
        name: 'Detail', phase: 'PLAN', phaseKey: 'plan', color: '#6366F1',
        model: 'opus', upgrade: 'no downgrade',
        mission: 'Transform brief into formal PRD with NFRs and Given-When-Then criteria',
        exclusive: ['PRD authoring', 'NFR specification', 'Acceptance criteria', 'Edge cases', 'MoSCoW prioritization'],
        allowed: ['Expand requirements', 'Define user stories', 'Specify performance/security', 'Create traceability matrix'],
        blocked: ['Code implementation', 'Architecture design', 'Wireframes', 'Task decomposition'],
        outputs: ['prd.md'],
        rules: [{id:'dt-01',text:'Given-When-Then acceptance criteria'},{id:'dt-02',text:'Specify NFRs (performance, security, scalability)'},{id:'dt-03',text:'Document edge cases'},{id:'dt-04',text:'WHAT not HOW \u2014 no architecture decisions'},{id:'dt-05',text:'MoSCoW prioritization'}]
      },
      'architect': {
        name: 'Architect', phase: 'PLAN', phaseKey: 'plan', color: '#6366F1',
        model: 'opus', upgrade: 'no downgrade',
        mission: 'System architecture \u2014 tech stack, API design, DB schema, security review',
        exclusive: ['Architecture design', 'Tech stack selection', 'API contracts', 'DB schema', 'Security architecture'],
        allowed: ['Choose frameworks', 'Design components', 'Define data models', 'Specify auth/authz', 'Scalability strategies'],
        blocked: ['Code implementation', 'Deployment config', 'Wireframes', 'Task decomposition'],
        outputs: ['architecture.md'],
        rules: [{id:'ar-01',text:'Justify all tech stack decisions'},{id:'ar-02',text:'API contracts with versioning'},{id:'ar-03',text:'Security review (OWASP Top 10)'},{id:'ar-04',text:'DB schema with indexes and migrations'},{id:'ar-05',text:'Scalability patterns defined'}]
      },
      'ux': {
        name: 'UX', phase: 'PLAN', phaseKey: 'plan', color: '#6366F1',
        model: 'sonnet', upgrade: 'opus if design system from scratch',
        mission: 'User experience \u2014 flows, wireframes, Design System, accessibility (WCAG 2.1 AA)',
        exclusive: ['Wireframes', 'User flow mapping', 'Component hierarchy', 'Accessibility', 'Design System'],
        allowed: ['Create wireframes', 'Map journeys', 'Define design tokens', 'Validate WCAG 2.1 AA'],
        blocked: ['Code implementation', 'Backend logic', 'DB schema', 'API contracts'],
        outputs: ['ux-specification.md'],
        rules: [{id:'ux-01',text:'WCAG 2.1 AA compliance mandatory'},{id:'ux-02',text:'Responsive layouts (mobile/tablet/desktop)'},{id:'ux-03',text:'Complete user flows with error paths'},{id:'ux-04',text:'All component states specified'},{id:'ux-05',text:'No backend logic design'}]
      },
      'phases': {
        name: 'Phases', phase: 'PLAN', phaseKey: 'plan', color: '#6366F1',
        model: 'sonnet', upgrade: 'opus if 20+ requirements',
        mission: 'Break PRD into development phases \u2014 MVP-first, dependency mapping',
        exclusive: ['Phase breakdown', 'MVP scope', 'Phase dependencies', 'Risk prioritization', 'Milestone definition'],
        allowed: ['Decompose PRD', 'Identify dependencies', 'Define MVP', 'Estimate complexity'],
        blocked: ['Code implementation', 'Task decomposition', 'Detailed estimation', 'Deployment'],
        outputs: ['phases.md'],
        rules: [{id:'ph-01',text:'Phase 0 = MVP minimum viable'},{id:'ph-02',text:'Map dependencies and blockers'},{id:'ph-03',text:'Prioritize by value and risk'},{id:'ph-04',text:'MUST NOT decompose into tasks'},{id:'ph-05',text:'Each phase independently deployable'}]
      },
      'tasks': {
        name: 'Tasks', phase: 'PLAN', phaseKey: 'plan', color: '#6366F1',
        model: 'sonnet', upgrade: 'opus if 50+ tasks',
        mission: 'Atomic tasks (2-8h) with Given-When-Then acceptance criteria',
        exclusive: ['Task decomposition', 'Task criteria', 'Task estimation', 'Dependency mapping'],
        allowed: ['Break phases into tasks', 'Write descriptions', 'Estimate complexity', 'Identify blockers'],
        blocked: ['Code implementation', 'Architecture decisions', 'Phase planning', 'Deployment'],
        outputs: ['tasks.md'],
        rules: [{id:'tk-01',text:'Atomic tasks: 2-8 hours max'},{id:'tk-02',text:'Given-When-Then criteria'},{id:'tk-03',text:'Dependencies documented'},{id:'tk-04',text:'Consistent complexity scale'},{id:'tk-05',text:'MUST NOT implement code'}]
      },
      'qa-planning': {
        name: 'QA-Planning', phase: 'QUALITY', phaseKey: 'quality', color: '#8B5CF6',
        model: 'opus', upgrade: 'no downgrade',
        mission: 'Quality gate: PLAN to BUILD. Traceability validation, score of 95% or higher',
        exclusive: ['Test strategy', 'QA gate', 'Coverage planning', 'Risk matrix', 'Traceability validation'],
        allowed: ['Read all artifacts', 'Validate chains', 'Calculate quality scores', 'Silent correction loops'],
        blocked: ['Code implementation', 'Test execution', 'Deployment', 'Architecture modification'],
        outputs: ['qa-planning-report.md'],
        rules: [{id:'qap-score',text:'Gate requires 95% or higher completeness'},{id:'qap-coverage',text:'Cover ALL acceptance criteria'},{id:'qap-risk',text:'Risk matrix: Critical/High/Medium/Low'},{id:'qap-strategy',text:'Unit/integration/E2E categories'}]
      },
      'dev': {
        name: 'Dev', phase: 'BUILD', phaseKey: 'build', color: '#10B981',
        model: 'opus', upgrade: 'no downgrade',
        mission: 'Implementation with self-critique protocol \u2014 code, tests, refactoring',
        exclusive: ['Code implementation', 'Test writing', 'Refactoring', 'Debugging', 'PR preparation'],
        allowed: ['Read any file', 'Write project code', 'Run tests', 'Run linting', 'Git operations'],
        blocked: ['Architecture decisions', 'Requirement changes', 'Deployment', 'QA verdict'],
        outputs: ['Source code', 'Test files', 'PR description'],
        rules: [{id:'dev-task',text:'Implement exactly what task specifies'},{id:'dev-test',text:'Write tests for all new functionality'},{id:'dev-lint',text:'Zero linting warnings'},{id:'dev-patterns',text:'Follow existing patterns'},{id:'dev-iterate',text:'Iterate until criteria met'}]
      },
      'qa-implementation': {
        name: 'QA-Implementation', phase: 'QUALITY', phaseKey: 'quality', color: '#8B5CF6',
        model: 'opus', upgrade: 'no downgrade',
        mission: 'Quality gate: BUILD to DEPLOY. Tests + SAST + code review at 90% or higher',
        exclusive: ['Test execution', 'SAST scanning', 'Regression testing', 'QA verdict'],
        allowed: ['Read any file', 'Run tests', 'Run linting', 'Read test results'],
        blocked: ['Code implementation', 'Architecture modification', 'Deployment', 'Test strategy changes'],
        outputs: ['qa-implementation-report.md'],
        rules: [{id:'qai-verdict',text:'PASS / CONCERNS / FAIL / WAIVED'},{id:'qai-sast',text:'SAST mandatory; CRITICAL blocks'},{id:'qai-regression',text:'All existing tests must pass'},{id:'qai-backward',text:'Spec issues trigger backward transition'}]
      },
      'devops': {
        name: 'DevOps', phase: 'DEPLOY', phaseKey: 'deploy', color: '#F59E0B',
        model: 'sonnet', upgrade: 'opus if multi-environment/IaC',
        mission: 'CI/CD, deployment, monitoring, releases. EXCLUSIVE push and PR authority',
        exclusive: ['CI configuration', 'Deployment', 'Monitoring', 'Release prep', 'Push to remote', 'Create PRs'],
        allowed: ['Read any file', 'Write infra files', 'Deploy commands', 'Modify CI config'],
        blocked: ['Code implementation', 'Architecture decisions', 'Requirement changes', 'Test strategy'],
        outputs: ['README.md', 'CHANGELOG.md', 'API.md', 'Deploy config'],
        rules: [{id:'ops-qa-first',text:'Never deploy without QA approval'},{id:'ops-rollback',text:'Rollback procedure documented'},{id:'ops-monitor',text:'Monitoring before production'},{id:'ops-release',text:'Semantic versioning; CHANGELOG updated'}]
      }
    };

    /* ===== ARTICLES DATA ===== */
    const articles = [
      { num: 1, title: 'Pipeline Integrity', desc: 'All requests follow the pipeline sequence. No phase may be skipped.', enforcement: 'BLOCK', badge: 'block' },
      { num: 2, title: 'Agent Sovereignty', desc: 'Each agent has exclusive authority over its domain. Cross-domain actions are prohibited.', enforcement: 'BLOCK', badge: 'block' },
      { num: 3, title: 'Quality Gates', desc: 'Phase transitions require passing quality gates with quantified thresholds.', enforcement: 'BLOCK', badge: 'block' },
      { num: 4, title: 'Traceability Chain', desc: 'Every output traces back to a requirement. Unlinked artifacts are rejected.', enforcement: 'STRICT', badge: 'strict' },
      { num: 5, title: 'Handoff Protocol', desc: 'Two-layer handoff on every agent transition: structured YAML + narrative document.', enforcement: 'BLOCK', badge: 'block' },
      { num: 6, title: 'Context Preservation', desc: 'Session state persisted immediately. No data lost on compaction or crash.', enforcement: 'BLOCK', badge: 'block' },
      { num: 7, title: 'Mode Governance', desc: 'File access scope enforced by current mode. PLANNING cannot touch source code.', enforcement: 'BLOCK', badge: 'block' },
      { num: 8, title: 'Model Governance', desc: 'Each agent uses its assigned model tier. Cost-aware intelligence allocation.', enforcement: 'WARN', badge: 'warn' },
      { num: 9, title: 'Deviation Handling', desc: 'Out-of-scope requests handled by Orchestrator. Never silently ignored.', enforcement: 'GUIDE', badge: 'guide' },
      { num: 10, title: 'Artifact Immutability', desc: 'Completed artifacts require formal change request to modify.', enforcement: 'STRICT', badge: 'strict' },
      { num: 11, title: 'Self-Critique Protocol', desc: 'Dev agent must self-review before submitting. Catches bugs pre-test.', enforcement: 'STRICT', badge: 'strict' },
      { num: 12, title: 'Backward Transition', desc: 'Quality failures trigger return to source agent for correction.', enforcement: 'BLOCK', badge: 'block' },
      { num: 13, title: 'Session Continuity', desc: 'Sessions can resume from any point. State fully reconstructible from files.', enforcement: 'GUIDE', badge: 'guide' },
      { num: 14, title: 'Language Protocol', desc: 'Interaction in user language. All artifacts written in English.', enforcement: 'STRICT', badge: 'strict' },
      { num: 15, title: 'Security Review', desc: 'Architect must review OWASP Top 10. SAST blocks on critical findings.', enforcement: 'BLOCK', badge: 'block' },
      { num: 16, title: 'Atomic Tasks', desc: 'Tasks are 2-8 hours. Larger units must be decomposed.', enforcement: 'WARN', badge: 'warn' },
      { num: 17, title: 'Documentation Chain', desc: 'DevOps generates README, CHANGELOG, API docs. No deployment without docs.', enforcement: 'STRICT', badge: 'strict' }
    ];

    /* ===== PROTOCOLS DATA ===== */
    const protocols = [
      { id: 'P-1', name: 'Pipeline Sequence', desc: 'Enforce linear pipeline flow with deviation support' },
      { id: 'P-2', name: 'Agent Boundary', desc: 'Validate actions against agent exclusive/allowed/blocked' },
      { id: 'P-3', name: 'Quality Threshold', desc: 'Quantified gates with PASS/CONCERNS/FAIL/WAIVED' },
      { id: 'P-4', name: 'Two-Layer Handoff', desc: 'Structured YAML + narrative on every transition' },
      { id: 'P-5', name: 'Session Persistence', desc: 'Write state immediately; survive compaction' },
      { id: 'P-6', name: 'Deviation Protocol', desc: 'Orchestrator evaluates, redirects, or queues' },
      { id: 'P-7', name: 'Model Assignment', desc: 'Haiku/Sonnet/Opus matched to agent complexity' },
      { id: 'P-8', name: 'Backward Transition', desc: 'Failed gates return to producing agent' }
    ];

    /* ===== AGENT TRANSLATIONS ===== */
    const agentTranslations = {
      pt: {
        'orchestrator': {
          mission: 'Roteador central \u2014 gerencia pipeline, sess\u00f5es, desvios e coordena\u00e7\u00e3o multi-terminal',
          exclusive: ['Roteamento de requisi\u00e7\u00f5es', 'Sele\u00e7\u00e3o de agente', 'Gest\u00e3o de pipeline', 'Tratamento de desvios', 'Gest\u00e3o de sess\u00e3o', 'Troca de modo', 'Spawn de terminal'],
          allowed: ['Ler qualquer arquivo', 'Escrever session.yaml', 'Escrever documentos de handoff', 'Acionar quality gates'],
          blocked: ['Escrita direta de c\u00f3digo', 'Decis\u00f5es de arquitetura', 'Design UX', 'Deployment'],
          outputs: ['session.yaml', 'Documentos de handoff'],
          rules: [{id:'orch-route',text:'Rotear para o agente correto pelo estado do pipeline'},{id:'orch-single-entry',text:'Usu\u00e1rio interage apenas via /chati'},{id:'orch-pipeline',text:'Respeitar ordem do pipeline salvo desvio'},{id:'orch-handoff',text:'Handoff de duas camadas em toda transi\u00e7\u00e3o'},{id:'orch-session',text:'Persistir estado em session.yaml imediatamente'}],
          upgrade: 'opus para roteamento complexo'
        },
        'greenfield-wu': {
          mission: 'Descoberta operacional para projetos novos \u2014 stack tecnol\u00f3gico, scaffolding (estrutura inicial do projeto), conven\u00e7\u00f5es',
          exclusive: ['An\u00e1lise greenfield', 'Detec\u00e7\u00e3o de scaffolding (estrutura base do projeto)', 'Detec\u00e7\u00e3o de stack', 'Identifica\u00e7\u00e3o de conven\u00e7\u00f5es'],
          allowed: ['Ler package.json/config', 'Analisar estrutura', 'Detectar IDE/tooling', 'Recomendar scaffolding'],
          blocked: ['Modifica\u00e7\u00e3o de c\u00f3digo', 'Decis\u00f5es de arquitetura', 'Schema de BD (estrutura do banco de dados)', 'Design de API', 'An\u00e1lise brownfield'],
          outputs: ['wu-report.yaml'],
          rules: [{id:'gf-01',text:'DEVE redirecionar se c\u00f3digo fonte detectado'},{id:'gf-02',text:'DEVE analisar package.json se presente'},{id:'gf-03',text:'DEVE detectar configura\u00e7\u00e3o de IDE'},{id:'gf-04',text:'N\u00c3O DEVE tomar decis\u00f5es de arquitetura'},{id:'gf-05',text:'DEVE incluir recomenda\u00e7\u00f5es de scaffolding'}],
          upgrade: 'sonnet se multi-stack/enterprise'
        },
        'brownfield-wu': {
          mission: 'Descoberta profunda de codebase \u2014 scan de depend\u00eancias, mapeamento de arquitetura, avalia\u00e7\u00e3o de riscos',
          exclusive: ['An\u00e1lise brownfield', 'Mapeamento de grafo de depend\u00eancias', 'Avalia\u00e7\u00e3o de riscos', 'Detec\u00e7\u00e3o de padr\u00f5es arquiteturais'],
          allowed: ['Ler todo c\u00f3digo fonte', 'Analisar depend\u00eancias', 'Detectar padr\u00f5es', 'Avaliar qualidade/seguran\u00e7a', 'Mapear schemas de BD'],
          blocked: ['Modifica\u00e7\u00e3o de c\u00f3digo', 'Redesign de arquitetura', 'Novas funcionalidades', 'DevOps', 'An\u00e1lise greenfield'],
          outputs: ['wu-report.yaml'],
          rules: [{id:'bf-01',text:'Descoberta profunda OBRIGAT\u00d3RIA'},{id:'bf-02',text:'Analisar toda \u00e1rvore de depend\u00eancias'},{id:'bf-03',text:'Detectar padr\u00f5es de arquitetura'},{id:'bf-04',text:'N\u00c3O DEVE modificar c\u00f3digo (somente leitura)'},{id:'bf-05',text:'Avaliar d\u00edvida t\u00e9cnica com scores de risco'}],
          upgrade: 'sem downgrade'
        },
        'brief': {
          mission: 'Extrair e validar requisitos do projeto em 5 categorias (funcional, n\u00e3o-funcional, t\u00e9cnico, neg\u00f3cio e restri\u00e7\u00f5es)',
          exclusive: ['Extra\u00e7\u00e3o de requisitos', 'Mapeamento de stakeholders', 'Objetivos de neg\u00f3cio', 'Identifica\u00e7\u00e3o de restri\u00e7\u00f5es', 'M\u00e9tricas de sucesso'],
          allowed: ['Fazer perguntas de esclarecimento', 'Categorizar requisitos', 'Validar completude', 'Identificar lacunas'],
          blocked: ['Modifica\u00e7\u00e3o de c\u00f3digo', 'Decis\u00f5es de arquitetura', 'Autoria de PRD', 'Decomposi\u00e7\u00e3o de tasks'],
          outputs: ['brief-report.md'],
          rules: [{id:'br-01',text:'Extrair TODAS as 5 categorias de requisitos (funcional, n\u00e3o-funcional, t\u00e9cnico, neg\u00f3cio e restri\u00e7\u00f5es)'},{id:'br-02',text:'Esclarecer requisitos amb\u00edguos'},{id:'br-03',text:'Documentar todos os stakeholders'},{id:'br-04',text:'N\u00c3O DEVE expandir para formato PRD'},{id:'br-05',text:'Validar que m\u00e9tricas s\u00e3o mensur\u00e1veis'}],
          upgrade: 'opus se enterprise/10+ integra\u00e7\u00f5es'
        },
        'detail': {
          mission: 'Transformar brief em PRD formal com requisitos n\u00e3o-funcionais e crit\u00e9rios de aceite estruturados (Dado-Quando-Ent\u00e3o)',
          exclusive: ['Autoria de PRD', 'Requisitos n\u00e3o-funcionais (performance, seguran\u00e7a, escalabilidade)', 'Crit\u00e9rios de aceite', 'Casos extremos', 'Prioriza\u00e7\u00e3o MoSCoW (Must/Should/Could/Won\u2019t)'],
          allowed: ['Expandir requisitos', 'Definir user stories', 'Especificar performance/seguran\u00e7a', 'Criar matriz de rastreabilidade'],
          blocked: ['Implementa\u00e7\u00e3o de c\u00f3digo', 'Design de arquitetura', 'Wireframes', 'Decomposi\u00e7\u00e3o de tasks'],
          outputs: ['prd.md'],
          rules: [{id:'dt-01',text:'Crit\u00e9rios de aceite no formato Dado-Quando-Ent\u00e3o (Given-When-Then)'},{id:'dt-02',text:'Especificar requisitos n\u00e3o-funcionais (performance, seguran\u00e7a, escalabilidade)'},{id:'dt-03',text:'Documentar casos extremos'},{id:'dt-04',text:'O QUE n\u00e3o COMO \u2014 sem decis\u00f5es de arquitetura'},{id:'dt-05',text:'Priorizar por MoSCoW: Must (obrigat\u00f3rio), Should (deveria), Could (poderia), Won\u2019t (n\u00e3o agora)'}],
          upgrade: 'sem downgrade'
        },
        'architect': {
          mission: 'Arquitetura de sistema \u2014 stack tecnol\u00f3gico, design de API, schema de BD, revis\u00e3o de seguran\u00e7a',
          exclusive: ['Design de arquitetura', 'Sele\u00e7\u00e3o de stack', 'Contratos de API', 'Schema de BD (estrutura do banco de dados)', 'Arquitetura de seguran\u00e7a'],
          allowed: ['Escolher frameworks', 'Projetar componentes', 'Definir modelos de dados', 'Especificar autentica\u00e7\u00e3o/autoriza\u00e7\u00e3o', 'Estrat\u00e9gias de escalabilidade'],
          blocked: ['Implementa\u00e7\u00e3o de c\u00f3digo', 'Configura\u00e7\u00e3o de deploy', 'Wireframes', 'Decomposi\u00e7\u00e3o de tasks'],
          outputs: ['architecture.md'],
          rules: [{id:'ar-01',text:'Justificar todas as decis\u00f5es de stack'},{id:'ar-02',text:'Contratos de API com versionamento'},{id:'ar-03',text:'Revis\u00e3o de seguran\u00e7a contra as 10 vulnerabilidades mais cr\u00edticas da web (OWASP Top 10)'},{id:'ar-04',text:'Schema de BD com \u00edndices e migrations'},{id:'ar-05',text:'Padr\u00f5es de escalabilidade definidos'}],
          upgrade: 'sem downgrade'
        },
        'ux': {
          mission: 'Experi\u00eancia do usu\u00e1rio \u2014 fluxos, wireframes, Design System, acessibilidade digital',
          exclusive: ['Wireframes', 'Mapeamento de fluxos', 'Hierarquia de componentes', 'Acessibilidade', 'Design System'],
          allowed: ['Criar wireframes', 'Mapear jornadas', 'Definir design tokens', 'Validar acessibilidade (WCAG 2.1 AA \u2014 padr\u00e3o internacional de acessibilidade web)'],
          blocked: ['Implementa\u00e7\u00e3o de c\u00f3digo', 'L\u00f3gica de backend', 'Schema de BD', 'Contratos de API'],
          outputs: ['ux-specification.md'],
          rules: [{id:'ux-01',text:'Acessibilidade obrigat\u00f3ria: contraste, navega\u00e7\u00e3o por teclado, leitor de tela (WCAG 2.1 AA)'},{id:'ux-02',text:'Layouts responsivos (mobile/tablet/desktop)'},{id:'ux-03',text:'Fluxos completos com caminhos de erro'},{id:'ux-04',text:'Todos os estados de componente especificados'},{id:'ux-05',text:'Sem design de l\u00f3gica backend'}],
          upgrade: 'opus se design system do zero'
        },
        'phases': {
          mission: 'Quebrar PRD em fases de desenvolvimento \u2014 MVP primeiro, mapeamento de depend\u00eancias',
          exclusive: ['Decomposi\u00e7\u00e3o em fases', 'Escopo do MVP', 'Depend\u00eancias entre fases', 'Prioriza\u00e7\u00e3o por risco', 'Defini\u00e7\u00e3o de marcos'],
          allowed: ['Decompor PRD', 'Identificar depend\u00eancias', 'Definir MVP', 'Estimar complexidade'],
          blocked: ['Implementa\u00e7\u00e3o de c\u00f3digo', 'Decomposi\u00e7\u00e3o em tasks', 'Estimativa detalhada', 'Deployment'],
          outputs: ['phases.md'],
          rules: [{id:'ph-01',text:'Fase 0 = MVP m\u00ednimo vi\u00e1vel'},{id:'ph-02',text:'Mapear depend\u00eancias e bloqueios'},{id:'ph-03',text:'Priorizar por valor e risco'},{id:'ph-04',text:'N\u00c3O DEVE decompor em tasks'},{id:'ph-05',text:'Cada fase deploy\u00e1vel independentemente'}],
          upgrade: 'opus se 20+ requisitos'
        },
        'tasks': {
          mission: 'Tasks at\u00f4micas (2-8h) com crit\u00e9rios de aceite estruturados (Dado-Quando-Ent\u00e3o)',
          exclusive: ['Decomposi\u00e7\u00e3o em tasks', 'Crit\u00e9rios de tasks', 'Estimativa de tasks', 'Mapeamento de depend\u00eancias'],
          allowed: ['Quebrar fases em tasks', 'Escrever descri\u00e7\u00f5es', 'Estimar complexidade', 'Identificar bloqueios'],
          blocked: ['Implementa\u00e7\u00e3o de c\u00f3digo', 'Decis\u00f5es de arquitetura', 'Planejamento de fases', 'Deployment'],
          outputs: ['tasks.md'],
          rules: [{id:'tk-01',text:'Tasks at\u00f4micas: 2-8 horas m\u00e1ximo'},{id:'tk-02',text:'Crit\u00e9rios no formato Dado-Quando-Ent\u00e3o'},{id:'tk-03',text:'Depend\u00eancias documentadas'},{id:'tk-04',text:'Escala de complexidade consistente'},{id:'tk-05',text:'N\u00c3O DEVE implementar c\u00f3digo'}],
          upgrade: 'opus se 50+ tasks'
        },
        'qa-planning': {
          mission: 'Quality gate: PLAN para BUILD. Valida\u00e7\u00e3o de rastreabilidade, score de 95% ou superior',
          exclusive: ['Estrat\u00e9gia de testes', 'Gate de QA', 'Planejamento de cobertura', 'Matriz de riscos', 'Valida\u00e7\u00e3o de rastreabilidade'],
          allowed: ['Ler todos os artefatos', 'Validar cadeias', 'Calcular scores de qualidade', 'Loops de corre\u00e7\u00e3o silenciosa'],
          blocked: ['Implementa\u00e7\u00e3o de c\u00f3digo', 'Execu\u00e7\u00e3o de testes', 'Deployment', 'Modifica\u00e7\u00e3o de arquitetura'],
          outputs: ['qa-planning-report.md'],
          rules: [{id:'qap-score',text:'Gate requer 95% ou mais de completude'},{id:'qap-coverage',text:'Cobrir TODOS os crit\u00e9rios de aceite'},{id:'qap-risk',text:'Matriz de risco: Cr\u00edtico/Alto/M\u00e9dio/Baixo'},{id:'qap-strategy',text:'Categorias unit\u00e1rio/integra\u00e7\u00e3o/E2E'}],
          upgrade: 'sem downgrade'
        },
        'dev': {
          mission: 'Implementa\u00e7\u00e3o com protocolo de autocr\u00edtica \u2014 c\u00f3digo, testes, refatora\u00e7\u00e3o',
          exclusive: ['Implementa\u00e7\u00e3o de c\u00f3digo', 'Escrita de testes', 'Refatora\u00e7\u00e3o', 'Debugging', 'Prepara\u00e7\u00e3o de PR'],
          allowed: ['Ler qualquer arquivo', 'Escrever c\u00f3digo do projeto', 'Rodar testes', 'Rodar linting', 'Opera\u00e7\u00f5es Git'],
          blocked: ['Decis\u00f5es de arquitetura', 'Mudan\u00e7as de requisitos', 'Deployment', 'Veredicto de QA'],
          outputs: ['C\u00f3digo fonte', 'Arquivos de teste', 'Descri\u00e7\u00e3o do PR'],
          rules: [{id:'dev-task',text:'Implementar exatamente o que a task especifica'},{id:'dev-test',text:'Escrever testes para toda nova funcionalidade'},{id:'dev-lint',text:'Zero avisos de linting'},{id:'dev-patterns',text:'Seguir padr\u00f5es existentes'},{id:'dev-iterate',text:'Iterar at\u00e9 crit\u00e9rios atendidos'}],
          upgrade: 'sem downgrade'
        },
        'qa-implementation': {
          mission: 'Quality gate: BUILD para DEPLOY. Testes + an\u00e1lise de seguran\u00e7a do c\u00f3digo + revis\u00e3o com 90% ou superior',
          exclusive: ['Execu\u00e7\u00e3o de testes', 'An\u00e1lise de seguran\u00e7a est\u00e1tica do c\u00f3digo (SAST \u2014 busca vulnerabilidades sem executar)', 'Testes de regress\u00e3o (garantir que nada que funcionava parou de funcionar)', 'Veredicto de QA'],
          allowed: ['Ler qualquer arquivo', 'Rodar testes', 'Rodar linting', 'Ler resultados de teste'],
          blocked: ['Implementa\u00e7\u00e3o de c\u00f3digo', 'Modifica\u00e7\u00e3o de arquitetura', 'Deployment', 'Mudan\u00e7as na estrat\u00e9gia de testes'],
          outputs: ['qa-implementation-report.md'],
          rules: [{id:'qai-verdict',text:'Veredicto: PASS / CONCERNS / FAIL / WAIVED'},{id:'qai-sast',text:'An\u00e1lise de seguran\u00e7a obrigat\u00f3ria; vulnerabilidades cr\u00edticas bloqueiam'},{id:'qai-regression',text:'Todos os testes existentes devem continuar passando'},{id:'qai-backward',text:'Problemas na spec disparam transi\u00e7\u00e3o reversa'}],
          upgrade: 'sem downgrade'
        },
        'devops': {
          mission: 'CI/CD, deployment, monitoramento, releases. Autoridade EXCLUSIVA de push e PR',
          exclusive: ['Configura\u00e7\u00e3o de CI', 'Deployment', 'Monitoramento', 'Prepara\u00e7\u00e3o de release', 'Push para remoto', 'Criar PRs'],
          allowed: ['Ler qualquer arquivo', 'Escrever arquivos de infra', 'Comandos de deploy', 'Modificar config de CI'],
          blocked: ['Implementa\u00e7\u00e3o de c\u00f3digo', 'Decis\u00f5es de arquitetura', 'Mudan\u00e7as de requisitos', 'Estrat\u00e9gia de testes'],
          outputs: ['README.md', 'CHANGELOG.md', 'API.md', 'Config de deploy'],
          rules: [{id:'ops-qa-first',text:'Nunca fazer deploy sem aprova\u00e7\u00e3o do QA'},{id:'ops-rollback',text:'Procedimento de rollback documentado'},{id:'ops-monitor',text:'Monitoramento antes da produ\u00e7\u00e3o'},{id:'ops-release',text:'Versionamento sem\u00e2ntico; CHANGELOG atualizado'}],
          upgrade: 'opus se multi-ambiente/IaC'
        }
      }
    };

    /* ===== ARTICLES TRANSLATIONS ===== */
    const articlesTranslations = {
      pt: [
        { title: 'Integridade do Pipeline', desc: 'Todas as requisi\u00e7\u00f5es seguem a sequ\u00eancia do pipeline. Nenhuma fase pode ser pulada.' },
        { title: 'Soberania do Agente', desc: 'Cada agente tem autoridade exclusiva sobre seu dom\u00ednio. A\u00e7\u00f5es cross-domain s\u00e3o proibidas.' },
        { title: 'Quality Gates', desc: 'Transi\u00e7\u00f5es de fase requerem aprova\u00e7\u00e3o em quality gates com thresholds quantificados.' },
        { title: 'Cadeia de Rastreabilidade', desc: 'Toda sa\u00edda rastreia de volta a um requisito. Artefatos n\u00e3o vinculados s\u00e3o rejeitados.' },
        { title: 'Protocolo de Handoff', desc: 'Handoff de duas camadas em toda transi\u00e7\u00e3o: YAML estruturado + documento narrativo.' },
        { title: 'Preserva\u00e7\u00e3o de Contexto', desc: 'Estado da sess\u00e3o persistido imediatamente. Sem perda de dados em compacta\u00e7\u00e3o ou crash.' },
        { title: 'Governan\u00e7a de Modo', desc: 'Escopo de acesso a arquivos aplicado pelo modo atual. PLANNING n\u00e3o pode tocar c\u00f3digo fonte.' },
        { title: 'Governan\u00e7a de Modelo', desc: 'Cada agente usa sua tier de modelo atribu\u00edda. Aloca\u00e7\u00e3o de intelig\u00eancia consciente de custos.' },
        { title: 'Tratamento de Desvios', desc: 'Requisi\u00e7\u00f5es fora de escopo s\u00e3o tratadas pelo Orchestrator. Nunca ignoradas silenciosamente.' },
        { title: 'Imutabilidade de Artefatos', desc: 'Artefatos conclu\u00eddos requerem solicita\u00e7\u00e3o formal de mudan\u00e7a para modifica\u00e7\u00e3o.' },
        { title: 'Protocolo de Autocr\u00edtica', desc: 'Agente Dev deve fazer auto-revis\u00e3o antes de submeter. Captura bugs pr\u00e9-teste.' },
        { title: 'Transi\u00e7\u00e3o Reversa', desc: 'Falhas em quality gates disparam retorno ao agente de origem para corre\u00e7\u00e3o.' },
        { title: 'Continuidade de Sess\u00e3o', desc: 'Sess\u00f5es podem ser retomadas de qualquer ponto. Estado totalmente reconstru\u00edvel a partir de arquivos.' },
        { title: 'Protocolo de Idioma', desc: 'Intera\u00e7\u00e3o no idioma do usu\u00e1rio. Todos os artefatos escritos em ingl\u00eas.' },
        { title: 'Revis\u00e3o de Seguran\u00e7a', desc: 'Architect deve revisar OWASP Top 10. SAST bloqueia em achados cr\u00edticos.' },
        { title: 'Tasks At\u00f4micas', desc: 'Tasks s\u00e3o de 2-8 horas. Unidades maiores devem ser decompostas.' },
        { title: 'Cadeia de Documenta\u00e7\u00e3o', desc: 'DevOps gera README, CHANGELOG, docs de API. Sem deployment sem docs.' }
      ]
    };

    /* ===== PROTOCOLS TRANSLATIONS ===== */
    const protocolsTranslations = {
      pt: [
        { name: 'Sequ\u00eancia do Pipeline', desc: 'Aplicar fluxo linear do pipeline com suporte a desvios' },
        { name: 'Fronteira do Agente', desc: 'Validar a\u00e7\u00f5es contra exclusivo/permitido/bloqueado do agente' },
        { name: 'Threshold de Qualidade', desc: 'Gates quantificados com PASS/CONCERNS/FAIL/WAIVED' },
        { name: 'Handoff de Duas Camadas', desc: 'YAML estruturado + narrativa em toda transi\u00e7\u00e3o' },
        { name: 'Persist\u00eancia de Sess\u00e3o', desc: 'Gravar estado imediatamente; sobreviver compacta\u00e7\u00e3o' },
        { name: 'Protocolo de Desvio', desc: 'Orchestrator avalia, redireciona ou enfileira' },
        { name: 'Atribui\u00e7\u00e3o de Modelo', desc: 'Haiku/Sonnet/Opus ajustado \u00e0 complexidade do agente' },
        { name: 'Transi\u00e7\u00e3o Reversa', desc: 'Gates falhados retornam ao agente produtor' }
      ]
    };

    /* ===== MODAL LABELS ===== */
    const modalLabels = {
      en: { exclusive: 'Exclusive Authority', allowed: 'Allowed', blocked: 'Blocked', outputs: 'Outputs', rules: 'Rules', upgrade: 'Model Upgrade' },
      pt: { exclusive: 'Autoridade Exclusiva', allowed: 'Permitido', blocked: 'Bloqueado', outputs: 'Sa\u00eddas', rules: 'Regras', upgrade: 'Upgrade de Modelo' }
    };

    /* ===== RENDER AGENTS ===== */
    function getAgentData(agentId) {
      var a = agents[agentId];
      if (currentLang === 'pt' && agentTranslations.pt[agentId]) {
        var t = agentTranslations.pt[agentId];
        return {
          name: a.name, command: a.command, phase: a.phase, phaseKey: a.phaseKey, color: a.color, model: a.model,
          mission: t.mission, exclusive: t.exclusive, allowed: t.allowed, blocked: t.blocked,
          outputs: t.outputs, rules: t.rules, upgrade: t.upgrade
        };
      }
      return a;
    }

    function renderAgents() {
      var container = document.getElementById('agentsContainer');
      var phaseOrder = [
        { key: 'orchestrator', label: 'ORCHESTRATOR', agents: ['orchestrator'] },
        { key: 'discover', label: 'DISCOVER', agents: ['greenfield-wu', 'brownfield-wu', 'brief'] },
        { key: 'plan', label: 'PLAN', agents: ['detail', 'architect', 'ux', 'phases', 'tasks'] },
        { key: 'quality', label: 'QUALITY', agents: ['qa-planning', 'qa-implementation'] },
        { key: 'build', label: 'BUILD', agents: ['dev'] },
        { key: 'deploy', label: 'DEPLOY', agents: ['devops'] }
      ];

      var html = '';
      phaseOrder.forEach(function(group) {
        html += '<div class="agents-phase-group">';
        html += '<div class="agents-phase-header reveal" data-phase="' + group.key + '">' + group.label + '</div>';
        html += '<div class="agents-grid">';
        group.agents.forEach(function(agentId, i) {
          var a = getAgentData(agentId);
          html += '<div class="agent-card reveal reveal-delay-' + ((i % 3) + 1) + '" data-phase="' + a.phaseKey + '" id="agent-' + agentId + '" onclick="openAgentModal(\'' + agentId + '\')">';
          html += '<div class="agent-header"><span class="agent-name">' + a.name + '</span><span class="agent-model-badge ' + a.model + '">' + a.model + '</span></div>';
          html += '<p class="agent-mission">' + a.mission + '</p>';
          html += '<span class="agent-phase-badge" data-phase="' + a.phaseKey + '">' + a.phase + '</span>';
          html += '</div>';
        });
        html += '</div></div>';
      });
      container.innerHTML = html;
    }

    /* ===== RENDER ARTICLES ===== */
    function renderArticles() {
      var grid = document.getElementById('articlesGrid');
      var articleLabel = currentLang === 'pt' ? 'Artigo' : 'Article';
      grid.innerHTML = articles.map(function(a, i) {
        var title = a.title;
        var desc = a.desc;
        if (currentLang === 'pt' && articlesTranslations.pt[i]) {
          title = articlesTranslations.pt[i].title;
          desc = articlesTranslations.pt[i].desc;
        }
        return '<div class="article-card reveal reveal-delay-' + ((i % 3) + 1) + '"><div class="article-number">' + articleLabel + ' ' + a.num + '</div><div class="article-title">' + title + '</div><div class="article-desc">' + desc + '</div><span class="enforcement-badge ' + a.badge + '">' + a.enforcement + '</span></div>';
      }).join('');
    }

    /* ===== RENDER PROTOCOLS ===== */
    function renderProtocols() {
      var grid = document.getElementById('protocolsGrid');
      grid.innerHTML = protocols.map(function(p, i) {
        var name = p.name;
        var desc = p.desc;
        if (currentLang === 'pt' && protocolsTranslations.pt[i]) {
          name = protocolsTranslations.pt[i].name;
          desc = protocolsTranslations.pt[i].desc;
        }
        return '<div class="protocol-card reveal reveal-delay-' + ((i % 4) + 1) + '"><div class="protocol-id">' + p.id + '</div><div class="protocol-name">' + name + '</div><div class="protocol-desc">' + desc + '</div></div>';
      }).join('');
    }

    /* ===== AGENT MODAL ===== */
    function openAgentModal(agentId) {
      var a = getAgentData(agentId);
      var baseAgent = agents[agentId];
      var labels = modalLabels[currentLang] || modalLabels.en;

      var phaseColors = { orchestrator: 'var(--orchestrator)', discover: 'var(--discover)', plan: 'var(--plan)', quality: 'var(--quality)', build: 'var(--build)', deploy: 'var(--deploy)' };
      var borderColor = phaseColors[a.phaseKey] || 'var(--discover)';
      var phaseBgColors = { orchestrator: 'rgba(245,158,11,0.1)', discover: 'rgba(59,130,246,0.1)', plan: 'rgba(99,102,241,0.1)', quality: 'rgba(139,92,246,0.1)', build: 'rgba(16,185,129,0.1)', deploy: 'rgba(245,158,11,0.1)' };

      var modal = document.getElementById('agentModal');
      modal.style.borderLeft = '4px solid ' + (baseAgent.color || '#3B82F6');

      var html = '';
      html += '<div class="agent-modal-header">';
      html += '<span class="agent-modal-name">' + a.name + '</span>';
      html += '<span class="agent-model-badge ' + baseAgent.model + '">' + baseAgent.model + '</span>';
      html += '</div>';
      html += '<p class="agent-modal-mission">' + a.mission + '</p>';
      html += '<span class="agent-modal-phase" style="background:' + (phaseBgColors[a.phaseKey] || '') + ';color:' + borderColor + ';">' + a.phase + '</span>';
      html += '<div class="agent-modal-sections">';
      html += '<div class="agent-modal-section exclusive-section">';
      html += '<div class="agent-modal-section-label">' + labels.exclusive + '</div>';
      html += '<ul class="agent-modal-list exclusive">' + a.exclusive.map(function(x){return '<li>' + x + '</li>';}).join('') + '</ul>';
      html += '</div>';
      html += '<div class="agent-modal-section allowed-section">';
      html += '<div class="agent-modal-section-label">' + labels.allowed + '</div>';
      html += '<ul class="agent-modal-list allowed">' + a.allowed.map(function(x){return '<li>' + x + '</li>';}).join('') + '</ul>';
      html += '</div>';
      html += '<div class="agent-modal-section blocked-section">';
      html += '<div class="agent-modal-section-label">' + labels.blocked + '</div>';
      html += '<ul class="agent-modal-list blocked">' + a.blocked.map(function(x){return '<li>' + x + '</li>';}).join('') + '</ul>';
      html += '</div>';
      html += '<div class="agent-modal-section outputs-section">';
      html += '<div class="agent-modal-section-label">' + labels.outputs + '</div>';
      html += '<ul class="agent-modal-list outputs">' + a.outputs.map(function(x){return '<li>' + x + '</li>';}).join('') + '</ul>';
      html += '</div>';
      html += '<div class="agent-modal-section rules-section">';
      html += '<div class="agent-modal-section-label">' + labels.rules + '</div>';
      html += '<ul class="agent-modal-list rules rules-list">' + a.rules.map(function(r){return '<li><strong>' + r.id + '</strong>: ' + r.text + '</li>';}).join('') + '</ul>';
      html += '</div>';
      html += '</div>';
      html += '<div class="agent-modal-upgrade"><strong>' + labels.upgrade + ':</strong> ' + a.upgrade + '</div>';

      document.getElementById('agentModalContent').innerHTML = html;
      document.getElementById('agentModalOverlay').classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    function closeAgentModal() {
      document.getElementById('agentModalOverlay').classList.remove('active');
      document.body.style.overflow = '';
      var modal = document.getElementById('agentModal');
      modal.style.borderLeft = '';
    }

    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') closeAgentModal();
    });

    /* ===== SCROLL TO SECTION ===== */
    function scrollToSection(id) {
      document.getElementById(id).scrollIntoView({ behavior: 'smooth' });
    }

    /* ===== COUNTER ANIMATION ===== */
    function animateCounter(el, target) {
      var current = 0;
      var increment = target / 40;
      var timer = setInterval(function() {
        current += increment;
        if (current >= target) {
          current = target;
          clearInterval(timer);
        }
        el.textContent = Math.floor(current);
      }, 30);
    }

    /* ===== INTERSECTION OBSERVERS ===== */
    var revealObserver = new IntersectionObserver(function(entries) {
      entries.forEach(function(entry) {
        if (entry.isIntersecting) {
          entry.target.classList.add('visible');
        }
      });
    }, { threshold: 0.1 });

    var statsAnimated = false;
    var statsObserver = new IntersectionObserver(function(entries) {
      entries.forEach(function(entry) {
        if (entry.isIntersecting && !statsAnimated) {
          statsAnimated = true;
          document.querySelectorAll('.hero-stat-number').forEach(function(el) {
            var target = parseInt(el.dataset.target, 10);
            animateCounter(el, target);
          });
        }
      });
    }, { threshold: 0.5 });

    var heroObserver = new IntersectionObserver(function(entries) {
      var nav = document.getElementById('stickyNav');
      entries.forEach(function(entry) {
        if (entry.isIntersecting) {
          nav.classList.remove('visible');
        } else {
          nav.classList.add('visible');
        }
      });
    }, { threshold: 0.1 });

    var sectionIds = ['hero', 'how-it-works', 'pipeline', 'agents', 'prism', 'hooks', 'constitution', 'memory-quality'];
    var sectionObserver = new IntersectionObserver(function(entries) {
      entries.forEach(function(entry) {
        if (entry.isIntersecting) {
          document.querySelectorAll('.nav-pill').forEach(function(pill) { pill.classList.remove('active'); });
          var activePill = document.querySelector('.nav-pill[data-section="' + entry.target.id + '"]');
          if (activePill) activePill.classList.add('active');
        }
      });
    }, { threshold: 0.2, rootMargin: '-20% 0px -60% 0px' });

    /* ===== CONTEXT METER ANIMATION ===== */
    function animateContextMeter() {
      var indicator = document.getElementById('meterIndicator');
      var positions = [10, 35, 60, 85, 60, 35, 10];
      var index = 0;
      setInterval(function() {
        indicator.style.top = positions[index] + '%';
        index = (index + 1) % positions.length;
      }, 2500);
    }

    /* ===== PIPELINE TOOLTIPS ===== */
    function setupPipelineTooltips() {
      var tooltip = document.getElementById('pipelineTooltip');
      var agentMissionsEN = {
        'greenfield-wu': 'Greenfield WU: Operational discovery for new projects',
        'brownfield-wu': 'Brownfield WU: Deep codebase discovery for existing projects',
        'brief': 'Brief: Extract and validate project requirements',
        'detail': 'Detail: Transform brief into formal PRD',
        'architect': 'Architect: System architecture, tech stack, API design',
        'ux': 'UX: User experience, flows, Design System, accessibility',
        'phases': 'Phases: Break PRD into development phases',
        'tasks': 'Tasks: Atomic tasks (2-8h) with acceptance criteria',
        'qa-planning': 'QA-Planning: Quality gate \u2014 PLAN to BUILD (\u226595%)',
        'dev': 'Dev: Implementation with self-critique protocol',
        'qa-implementation': 'QA-Implementation: Quality gate \u2014 BUILD to DEPLOY (\u226590%)',
        'devops': 'DevOps: CI/CD, deployment, monitoring, releases'
      };
      var agentMissionsPT = {
        'greenfield-wu': 'Greenfield WU: Descoberta operacional para projetos novos',
        'brownfield-wu': 'Brownfield WU: Descoberta profunda de codebase existente',
        'brief': 'Brief: Extrair e validar requisitos do projeto',
        'detail': 'Detail: Transformar brief em PRD formal',
        'architect': 'Architect: Arquitetura de sistema, stack, design de API',
        'ux': 'UX: Experi\u00eancia do usu\u00e1rio, fluxos, Design System, acessibilidade',
        'phases': 'Phases: Quebrar PRD em fases de desenvolvimento',
        'tasks': 'Tasks: Tasks at\u00f4micas (2-8h) com crit\u00e9rios de aceite',
        'qa-planning': 'QA-Planning: Quality gate \u2014 PLAN para BUILD (\u226595%)',
        'dev': 'Dev: Implementa\u00e7\u00e3o com protocolo de autocr\u00edtica',
        'qa-implementation': 'QA-Implementation: Quality gate \u2014 BUILD para DEPLOY (\u226590%)',
        'devops': 'DevOps: CI/CD, deployment, monitoramento, releases'
      };
      var agentMissions = currentLang === 'pt' ? agentMissionsPT : agentMissionsEN;
      document.querySelectorAll('.pipeline-node').forEach(function(node) {
        node.addEventListener('mouseenter', function(e) {
          var agentKey = node.dataset.agent;
          var missions = currentLang === 'pt' ? agentMissionsPT : agentMissionsEN;
          if (missions[agentKey]) {
            tooltip.textContent = missions[agentKey];
            tooltip.classList.add('show');
            var rect = node.getBoundingClientRect();
            tooltip.style.left = rect.left + 'px';
            tooltip.style.top = (rect.bottom + 8) + 'px';
          }
        });
        node.addEventListener('mouseleave', function() {
          tooltip.classList.remove('show');
        });
      });
    }

    /* ===== INIT ===== */
    document.addEventListener('DOMContentLoaded', function() {
      // Apply saved preferences
      applyTheme(currentTheme);
      applyLanguage(currentLang);

      renderAgents();
      renderArticles();
      renderProtocols();

      // Observe all reveals (including dynamically created ones)
      setTimeout(function() {
        document.querySelectorAll('.reveal').forEach(function(el) { revealObserver.observe(el); });
      }, 50);

      // Observe hero stats
      var heroStats = document.querySelector('.hero-stats');
      if (heroStats) statsObserver.observe(heroStats);

      // Observe hero for nav
      var heroSection = document.getElementById('hero');
      if (heroSection) heroObserver.observe(heroSection);

      // Observe sections for active nav
      sectionIds.forEach(function(id) {
        var section = document.getElementById(id);
        if (section) sectionObserver.observe(section);
      });

      // Context meter
      animateContextMeter();

      // Pipeline tooltips
      setupPipelineTooltips();
    });
  </script>
</body>
</html>
